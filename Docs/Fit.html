<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <meta http-equiv="content-type"
 content="text/html; charset=ISO-8859-1">
  <title>iFit: fitting a model onto iData objects</title>
</head>
<body>
<h1 style="text-align: center;"><a class="mozTocH1"
 name="mozTocId294096"></a>iFit: iData objects fitting</h1>
<br>
<ol id="mozToc">
<!--mozToc h3 1 h4 2 h3 3 h4 4 h5 5 h6 6-->
  <li><a href="#mozTocId73031">Fitting
a model to the Data</a>
    <ol>
      <li><a href="#mozTocId888705">Getting most of the
fit results</a></li>
    </ol>
  </li>
  <li><a href="#mozTocId410769">Specifying the optimization method</a>
    <ol>
      <li><a href="#mozTocId842297">Choosing an
optimization method</a></li>
      <li><a href="#mozTocId422448">Configuring the
optimization method</a></li>
      <li><a href="#mozTocId684694">Monitoring the
performance of the optimization method and the fit process</a></li>
    </ol>
  </li>
  <li><a href="#mozTocId919221">Model parameter constraints</a>
    <ol>
      <li><a href="#mozTocId267246">Fixed parameters</a></li>
      <li><a href="#mozTocId871054">Parameters varying
within limits</a></li>
      <li><a href="#mozTocId673530">Limiting parameter change</a></li>
    </ol>
  </li>
  <li><a href="#mozTocId179895">Estimating the model parameter
uncertainties</a></li>
  <li><a href="#mozTocId855522">Building model functions</a></li>
  <li><a href="#mozTocId778987">Specifying the optimization criteria</a></li>
</ol>
<br>
<hr style="width: 100%; height: 2px;">
<div style="text-align: center;">Commands we use in this page: iData/<span
 style="font-weight: bold; font-style: italic;">fits</span>, <span
 style="font-style: italic; font-weight: bold;">ieval</span> <a
 href="iFuncs.html">iFuncs</a> models and <a href="iOptim.html">iOptim</a>
routines<br>
</div>
<br>
This documentation details the procedure that can be used to find
optimal parameter set from a model in order to match (fit) an <a
 href="iData.html">iData</a>
object Signal with axes.<br>
<br>
<h3 style="text-align: center;"><a class="mozTocH3" name="mozTocId73031"></a>Fitting
a
model
to
the
Data</h3>
The <span style="font-style: italic; font-weight: bold;">fits</span>
function for <a href="iData.html">iData</a> objects provides a simple
mean to find the best model parameters which fit a data set. <br>
<pre style="margin-left: 40px;">&gt;&gt; a=<span
 style="color: rgb(51, 102, 255);">load</span>(iData, <span
 style="color: rgb(204, 51, 204);">[ ifitpath 'Data/sv1850.scn' ]</span>)<br>&gt;&gt; p=<span
 style="color: rgb(51, 102, 255);">fits</span>(a<span
 style="color: rgb(204, 51, 204);"></span>);<br>'Amplitude'    'Centre'    'HalfWidth'    'Background'<br> 0.6786         1.0008      0.0035         0.0002<br></pre>
will fit the data <span style="font-style: italic;">Signal/Monitor</span>
to a default 1D Gaussian function <span style="font-style: italic;">'gauss'</span>,
starting
from
automatically
guessed
initial
model
parameters. Of course, it is possible to chose explicitly
the model function, and the starting parameter set with e.g.<br>
<pre style="margin-left: 40px;">&gt;&gt; p=<span
 style="color: rgb(51, 102, 255);">fits</span>(a, <span
 style="color: rgb(204, 51, 204);">'gauss'</span>);                     % specify model function to use: gauss, and use guessed parameters<br>&gt;&gt; p=<span
 style="color: rgb(51, 102, 255);">fits</span>(a, <span
 style="color: rgb(204, 51, 204);">'gauss'</span>, [ 0.5 1 0.01 0 ]);   % specify the starting parameters for the model function<br></pre>
The result of the <span style="font-style: italic;">fits</span> method
is the model parameter set that matches best the data.<br>
A number of model functions is available from the <a href="iFuncs.html">iFuncs</a>
sub-library. Refer
to the section <a href="#mozTocId855522">below</a> in order to learn
how to define new fit models. You can get information about a model by
inquiring its name. When an object is specified, starting parameters
are guessed :<br>
<pre style="margin-left: 40px;">&gt;&gt; gauss<br>&gt;&gt; gauss(a)<br><br>ans = <br><br>          Type: 'iFit fitting function'<br>          Name: 'Gaussian (1D)'<br>    Parameters: {<span
 style="color: rgb(255, 0, 0);">'Amplitude'</span>  'Centre'  'HalfWidth'  'Background'}<br>     Dimension: 1<br>         Guess: [1 6.2172e-17 0.5861 0.1000]<br>        Values: [1x100 double]<br>          Axis: {[1x100 double]}</pre>
<br>
<a href="images/iData_fits_gauss.png"><img alt="fits(iData)"
 title="fits(iData)" src="images/iData_fits_gauss.png"
 style="border: 0px solid ; width: 200px; height: 177px;" align="right"></a>In
order
to
estimate
the
values
of the model for the fit parameters
onto the data set axes, one can use the <span
 style="font-style: italic; font-weight: bold;">ieval</span> method,
which is the same as Matlab <span
 style="font-style: italic; font-weight: bold;">feval, </span>but for <span
 style="font-style: italic;">iData</span> objects:
<pre style="margin-left: 40px;">&gt;&gt; b= <span
 style="color: rgb(51, 102, 255);">ieval</span>(a, <span
 style="color: rgb(204, 51, 204);">'gauss'</span>, p) % evaluate the 'gauss' model with parameters 'p' onto the 'a' data set axes<br>&gt;&gt; <span
 style="color: rgb(51, 102, 255);">plot</span>([ a b ])<br></pre>
The evaluated model contains <span style="font-style: italic;">Parameter</span>
and <span style="font-style: italic;">Model</span> aliases that hold
the model parameters and description. <br>
<br>
The <span style="font-style: italic;">fits</span> and <span
 style="font-style: italic;">ieval</span> functions work with any data
and model dimensionality, and can also build multi-dimensional models
from lower dimensionality functions (e.g. making a 2D Gaussian from
multiplied perpendicular 1D Gaussians).<br>
<h4><a class="mozTocH4" name="mozTocId888705"></a>Getting most of the
fit results</h4>
The <span style="font-style: italic;">fits</span> method can return
additional arguments<br>
<div style="text-align: center;">
<div style="text-align: left; margin-left: 40px;">
<pre>&gt;&gt; [parameters,criteria,message,<span
 style="color: rgb(255, 0, 0);">output</span>]= <span
 style="color: rgb(51, 102, 255);">fits</span>(a, <span
 style="color: rgb(204, 51, 204);">model, </span>initial_parameters,...)</pre>
</div>
</div>
The input arguments allow to specify:<br>
<ol>
  <li><span style="font-style: italic;">a</span>: an iData object, or
an array of objects</li>
  <li><span style="font-style: italic;">model: </span>the name of the
function or a function handle</li>
  <li><span style="font-style: italic;">initial_parameters: </span>a
set of starting parameters for the model. Using an <span
 style="font-weight: bold;">empty</span> set will trigger an <span
 style="font-weight: bold;">automatic estimate (guess)</span> of the
starting model parameters.<br>
  </li>
</ol>
The returned arguments are similar to those returned by the
Matlab <span style="font-style: italic;">fminsearch</span> non-linear
optimizer:<br>
<ol>
  <li><span style="font-style: italic;">parameters: </span>is the best
fit parameter set for the model</li>
  <li><span style="font-style: italic;">criteria: </span>is the
criteria value (<span style="font-style: italic;">least square</span>
by default - see below on how to change this setting)</li>
  <li><span style="font-style: italic;">message: </span>is the final
optimization routine state</li>
  <li><span style="font-style: italic;"><span
 style="color: rgb(255, 0, 0);">output</span>: </span>is a structure
that holds all the information gathered during the fit procedure</li>
</ol>
The most interesting output argument result is the 4th one <span
 style="color: rgb(255, 0, 0); font-style: italic;">output</span>,
which
provides significantly more information such as:<br>
<ul>
  <li><span style="font-style: italic;">output.algorithm: </span>Algorithm
used
(char)</li>
  <li><span style="font-style: italic;">output.message: </span>Message
which details the final state of the optimizer (char)<br>
  </li>
  <li><span style="font-style: italic;">output.</span><span
 style="font-style: italic;">funcCount: </span>Number of
function evaluations performed during the fit (double)</li>
  <li><span style="font-style: italic;">output.</span><span
 style="font-style: italic;">iterations: </span>Number of
iterations performed during the fit (double)</li>
  <li><span style="font-style: italic;">output.</span><span
 style="font-style: italic;">parsHistory: </span>Parameter
set history during optimization (double array)</li>
  <li><span style="font-style: italic;">output.</span><span
 style="font-style: italic;">criteriaHistory: </span>Criteria
history during optimization (double array)</li>
  <li><span style="font-style: italic;">output.</span><span
 style="font-style: italic;">modelValue: </span>Last model
evaluation (iData), that is <span style="font-style: italic;"><span
 style="color: rgb(51, 102, 255);">ieval</span>(a, model, parameters)</span><br>
  </li>
</ul>
<h3 style="text-align: center;"><a class="mozTocH3"
 name="mozTocId410769"></a>Specifying the optimization method</h3>
The iData <span style="font-weight: bold; font-style: italic;">fits</span>
method is a wrapper to any of the <a href="iOptim.html">iOptim</a>
optimizers,
with a specified fit criteria, and constraints handling, even for
methods that do not support it natively. Each optimizer can be
customized (<span style="font-style: italic;">e.g.</span> the maximum
number of iterations, the stop conditions, ...) with an <span
 style="font-style: italic;">options</span> structure.<br>
<pre style="margin-left: 40px;">&gt;&gt; <span
 style="font-style: italic;"></span>[parameters,criteria,message,output]= <span
 style="color: rgb(51, 102, 255);">fits</span>(a, <span
 style="color: rgb(204, 51, 204);">model, </span>initial_parameters, <span
 style="color: rgb(255, 0, 0);">options</span>)</pre>
<h4><a class="mozTocH4" name="mozTocId842297"></a>Choosing an
optimization method</h4>
The <a href="iOptim.html">iOptim</a> sub-library provides 21 different
optimization techniques. No doubt that choosing one at first sight is
difficult. We provide below a set of preferred optimizer, based on a
careful comparison explained in the <a href="iOptim.html">iOptim</a>
documentation.<br>
<br>
<table style="width: 100%; height: 261px;" border="1" cellpadding="1"
 cellspacing="1">
  <tbody>
    <tr>
    </tr>
    <tr>
      <td
 style="vertical-align: top; font-weight: bold; font-style: italic; color: rgb(51, 102, 255); background-color: rgb(255, 204, 204);">Optimizer<br>
      </td>
      <td
 style="vertical-align: top; background-color: rgb(255, 204, 204);"><span
 style="font-style: italic; font-weight: bold; color: rgb(51, 102, 255);">Description</span><br>
      </td>
      <td
 style="vertical-align: top; font-weight: bold; font-style: italic; color: rgb(51, 102, 255); background-color: rgb(255, 204, 204);">Mean
Success
rate
(%)<br>
      </td>
      <td
 style="vertical-align: top; font-weight: bold; font-style: italic; color: rgb(51, 102, 255); background-color: rgb(255, 204, 204);">Mean
execution
time
(s)<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><span
 style="font-style: italic; font-weight: bold;">fminimfil</span></td>
      <td style="vertical-align: top;">Unconstrained Implicit filtering
coupled with BFGS</td>
      <td style="vertical-align: top;">73.5</td>
      <td style="vertical-align: top;">0.09</td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><span
 style="font-style: italic; font-weight: bold;">fminralg</span></td>
      <td style="vertical-align: top;">Shor r-algorithm</td>
      <td style="vertical-align: top;">61.1</td>
      <td style="vertical-align: top;">0.17</td>
    </tr>
    <tr>
      <td
 style="vertical-align: top; font-weight: bold; font-style: italic;">fminpowell</td>
      <td style="vertical-align: top;">Powell Search</td>
      <td style="vertical-align: top;">56.5</td>
      <td style="vertical-align: top;">0.06</td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><span
 style="font-style: italic; font-weight: bold;">fminpso</span></td>
      <td style="vertical-align: top;">Particle Swarm Optimization</td>
      <td style="vertical-align: top;">58.5</td>
      <td style="vertical-align: top;">0.85</td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><span
 style="font-style: italic; font-weight: bold;">fminhooke</span></td>
      <td style="vertical-align: top;">Hooke-Jeeves direct search</td>
      <td style="vertical-align: top;">73.2</td>
      <td style="vertical-align: top; color: rgb(255, 0, 0);">1.87</td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><span
 style="font-weight: bold; font-style: italic;">fminswarm</span></td>
      <td style="vertical-align: top;"> Particule
Swarm Optimizer (alt. implementation)<br>
      </td>
      <td style="vertical-align: top;">40.0</td>
      <td style="vertical-align: top;">0.18</td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><span
 style="font-weight: bold; font-style: italic;">fmincmaes</span></td>
      <td style="vertical-align: top;">Evolution Strategy with
Covariance Matrix Adaptation</td>
      <td style="vertical-align: top;">48.6</td>
      <td style="vertical-align: top;"><span
 style="color: rgb(255, 0, 0);">2.54</span></td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><span style="font-style: italic;">fminsimpsa</span></td>
      <td style="vertical-align: top;">simplex/simulated
annealing</td>
      <td style="vertical-align: top;">36.9</td>
      <td style="vertical-align: top;">0.34</td>
    </tr>
  </tbody>
</table>
<span style="font-style: italic;">Table 1: A selection of the most
efficient and fast optimization methods</span><span
 style="font-style: italic; font-weight: bold;"></span><span
 style="font-style: italic;"> provided by the iFit/iOptim sub-library.</span><span
 style="font-style: italic;"><br>
</span><br>
The choice of the optimizer is done through a 4th input<span
 style="font-style: italic;"></span> argument <span
 style="font-style: italic;"><span style="color: rgb(255, 0, 0);">options</span>
</span>to <span style="font-style: italic;">fits.</span><br>
<h4><a class="mozTocH4" name="mozTocId422448"></a>Configuring the
optimization method</h4>
In order to use these optimizers, one just has to specify their name as
a <span style="font-style: italic;">fits</span> input argument, e.g. <span
 style="font-style: italic;"><span style="color: rgb(255, 0, 0);">options</span>=<span
 style="color: rgb(204, 51, 204);">'fminimfil'</span></span> :
<pre style="margin-left: 40px;">&gt;&gt; <span
 style="font-style: italic;"></span>[parameters,criteria,message,output]= <span
 style="color: rgb(51, 102, 255);">fits</span>(a, <span
 style="color: rgb(204, 51, 204);">model, </span>initial_parameters, <span
 style="color: rgb(204, 51, 204);">'fminimfil'</span>)<br></pre>
will select the <span style="font-style: italic;">Unconstrained
Implicit filtering coupled with BFGS</span> <span
 style="font-weight: bold; font-style: italic;">fminimfil</span>
optimizer to perform the fit. The default optimizer configuration will
be used, as obtained from the <span style="font-style: italic;">optimiset</span>
function, or from the method itself with <span
 style="color: rgb(204, 51, 204);">'defaults'</span> as parameter. This
latter call (<span style="font-style: italic;">i.e.</span> not with <span
 style="font-style: italic;">optimset</span>)<span
 style="font-style: italic;"> </span>provides more informations:<br>
<pre style="margin-left: 40px;">&gt;&gt; <span
 style="color: rgb(255, 0, 0);">options</span>=<span
 style="color: rgb(51, 102, 255);"></span><span
 style="color: rgb(51, 102, 255);"></span><span
 style="color: rgb(51, 102, 255);">fminimfil</span>(<span
 style="color: rgb(204, 51, 204);">'defaults'</span>)<br></pre>
Th<span style="font-style: italic;">e optimizer configuration</span> is
a structure which members enable to tune the behavior of the
optimization process. Each of the fields can be changed, e.g.<br>
<pre style="margin-left: 40px;">&gt;&gt; a=<span
 style="color: rgb(51, 102, 255);">load</span>(iData, <span
 style="color: rgb(204, 51, 204);">[ ifitpath 'Data/sv1850.scn' ]</span>)<br>&gt;&gt; <span
 style="color: rgb(255, 0, 0);">options</span>=<span
 style="color: rgb(51, 102, 255);"></span><span
 style="color: rgb(51, 102, 255);"></span><span
 style="color: rgb(51, 102, 255);">fminimfil</span>(<span
 style="color: rgb(204, 51, 204);">'defaults'</span>)<br>&gt;&gt; options.TolFun=0.01;<br>&gt;&gt; p=<span
 style="color: rgb(51, 102, 255);">fits</span>(a, <span
 style="color: rgb(204, 51, 204);">model, <span
 style="color: rgb(0, 0, 0);">[]</span></span>, <span
 style="color: rgb(255, 0, 0);">options</span>);<br></pre>
In addition to the default <span style="font-style: italic;">optimset</span>
structure fields, the iData <span style="font-style: italic;">fits</span>
and the <span style="font-style: italic;">iOptim</span> optimizers use
additional members in the structure:<br>
<ul>
  <li><span style="font-style: italic;">options.Display: </span>Level
of display [ off | iter | notify | final ]. Default is 'off'</li>
  <li><span style="font-style: italic;">options.</span><span
 style="font-style: italic;">MaxFunEvals: </span>Maximum number of
function evaluations allowed</li>
  <li><span style="font-style: italic;">options.</span><span
 style="font-style: italic;">MaxIter: </span>Maximum number of
iterations allowed</li>
  <li><span style="font-style: italic;">options.</span><span
 style="font-style: italic;">TolFun: </span>Termination tolerance on
the function value (absolute value or change)<br>
  </li>
  <li><span style="font-style: italic;">options.</span><span
 style="font-style: italic;">TolX: </span>Termination tolerance on
parameter change<br>
  </li>
  <li><span style="font-style: italic;">options.</span><span
 style="font-style: italic;">OutputFcn: </span>Name of an output
function (see <a href="#mozTocId684694">below</a>). You may use<span
 style="color: rgb(204, 51, 204);"> 'fminplot', </span>which is
provided in <span style="font-style: italic;">iOptim.</span></li>
  <li><span style="font-style: italic;">options.</span><span
 style="font-style: italic;">FunValCheck: </span>Check for invalid
values, such as NaN or complex<br>
  </li>
  <li><span style="font-style: italic;">options.</span><span
 style="font-style: italic;">algorithm: </span>is a description of the
optimization method</li>
  <li><span style="font-style: italic;">options.</span><span
 style="font-style: italic;">optimizer: </span>is the name of the
optimization function</li>
  <li>and more, depending on the optimizer method and implementation<br>
  </li>
</ul>
<h4><a class="mozTocH4" name="mozTocId684694"></a>Monitoring the
performance of the optimization method and the fit process</h4>
In order to follow the optimization process, you may define a call to a
user function at each optimization iteration. A default plotting
facility has been implemented as the <span
 style="font-style: italic; font-weight: bold;">fminplot</span>
function:<br>
<pre style="margin-left: 40px;">&gt;&gt; a=<span
 style="color: rgb(51, 102, 255);">load</span>(iData, <span
 style="color: rgb(204, 51, 204);">[ ifitpath 'Data/sv1850.scn' ]</span>)<br>&gt;&gt; options=<span
 style="color: rgb(51, 102, 255);"></span><span
 style="color: rgb(51, 102, 255);">fminimfil</span>(<span
 style="color: rgb(204, 51, 204);">'defaults'</span>)<br>&gt;&gt; options.<span
 style="color: rgb(255, 0, 0);">OutputFcn</span>=<span
 style="color: rgb(204, 51, 204);">'fminplot'</span>;<br>&gt;&gt; p=<span
 style="color: rgb(51, 102, 255);">fits</span>(a, <span
 style="color: rgb(204, 51, 204);">'gauss'</span>, [], <span
 style="color: rgb(204, 51, 204);"></span>options<span
 style="color: rgb(51, 102, 255);"></span>)<br>p =<br><br>    0.6263    1.0008   -0.0037    0.0002<br>&gt;&gt; b = <span
 style="color: rgb(51, 102, 255);">ieval</span>(a, <span
 style="color: rgb(204, 51, 204);">'gauss'</span>, p)<br>&gt;&gt; <span
 style="color: rgb(51, 102, 255);">figure; plot</span>([ a b ])<br></pre>
<div style="text-align: center;"><a href="images/iOptim_fminplot.png"><img
 alt="fits with options.OutputFcn=fminplot"
 title="fits with options.OutputFcn=fminplot"
 src="images/iOptim_fminplot.png"
 style="border: 0px solid ; width: 300px; height: 285px;"></a> <span
 style="text-decoration: underline;"><a
 href="images/iData_fits_gauss.png"><img
 alt="iData fits(gauss) with plot" title="iData fits(gauss) with plot"
 src="images/iData_fits_gauss.png"
 style="border: 0px solid ; width: 330px; height: 292px;"></a></span><br>
<span style="font-style: italic; font-weight: bold;">Left: </span>The <span
 style="font-style: italic;">options.OutputFcn='fminplot' </span>window
on
the
right,
showing
the
criteria evolution with the optimization
iteration and the 3 first fit parameters. The <span
 style="color: rgb(255, 0, 0);">red</span> dot indicates the
current/final parameter set and criteria. <span
 style="font-style: italic; font-weight: bold;">Right: </span>The
final fit result on the left.<br>
<div style="text-align: left;"><br>
Also, as explained <a href="#mozTocId888705">above</a>, it is possible
to obtain, on optimization completion, the whole criteria, and
parameter set history, as a function of iterations/criteria evaluations.<br>
<pre style="margin-left: 40px;"><span style="font-style: italic;"></span>&gt;&gt; [p,criteria,message,output]= <span
 style="color: rgb(51, 102, 255);">fits</span>(a, <span
 style="color: rgb(204, 51, 204);">'gauss'</span>, [], <span
 style="color: rgb(204, 51, 204);"></span>options<span
 style="color: rgb(51, 102, 255);"></span>)<br>&gt;&gt; output.parsHistory<br>&gt;&gt; output.criteriaHistory</pre>
</div>
</div>
<h3 style="text-align: center;"><a class="mozTocH3"
 name="mozTocId919221"></a>Model parameter constraints</h3>
In many cases, the model parameters are to be constrained. This
includes some fixed values, or bounds within which parameters should be
restricted. This is given to the fits method by mean of a 5th input
argument <span style="color: rgb(255, 0, 0); font-style: italic;">constraints</span>
:<br>
<pre style="margin-left: 40px;">&gt;&gt; <span
 style="font-style: italic;"></span>[parameters,criteria,message,output]= <span
 style="color: rgb(51, 102, 255);">fits</span>(a, <span
 style="color: rgb(204, 51, 204);">model, </span>initial_parameters, optimizer<span
 style="color: rgb(204, 51, 204);">, <span
 style="color: rgb(255, 0, 0);">constraints</span></span><span
 style="color: rgb(0, 0, 0);">)<br></span></pre>
<pre style="margin-left: 40px;"><span style="color: rgb(0, 0, 0);"></span><span
 style="color: rgb(0, 0, 0);"></span></pre>
<h4><a class="mozTocH4" name="mozTocId267246"></a>Fixed parameters</h4>
To fix some of the model parameters to their starting value, you just
need to define <span style="font-style: italic;">constraints</span> as
a vector with 0 for free parameters, and 1 for fixed parameters, e.g. :<br>
<pre style="margin-left: 40px;">&gt;&gt; a=<span
 style="color: rgb(51, 102, 255);">load</span>(iData, <span
 style="color: rgb(204, 51, 204);">[ ifitpath 'Data/sv1850.scn' ]</span>)<br>&gt;&gt; p=<span
 style="color: rgb(51, 102, 255);">fits</span>(a, <span
 style="color: rgb(204, 51, 204);">'gauss'</span>, [], <span
 style="color: rgb(204, 51, 204);">'fminimfil'</span>, [ <span
 style="color: rgb(255, 0, 0);">1</span> 0 0 0 ])<br>** Minimization performed on parameters:<br>    'Amplitude'    'Centre'    'HalfWidth'    'Background'<br><br>    <span
 style="color: rgb(255, 0, 0);">0.5936</span>    0.9998    0.0018    0.0050<br><br>p =<br><br>    <span
 style="color: rgb(255, 0, 0);">0.5936</span>    1.0008   -0.0037    0.0002<br><br></pre>
will fix the first model parameter, which is here the <span
 style="color: rgb(255, 0, 0);">Amplitude</span>. This can be checked
by simply entering the name of the model, which returns some
information structure :<br>
<pre style="margin-left: 40px;">&gt;&gt; gauss<br>ans = <br>          Type: 'iFit fitting function'<br>          Name: 'Gaussian (1D)'<br>    Parameters: {<span
 style="color: rgb(255, 0, 0);">'Amplitude'</span>  'Centre'  'HalfWidth'  'Background'}<br>     Dimension: 1<br>         Guess: [1 6.2172e-17 0.5861 0.1000]<br>        Values: [1x100 double]<br>          Axis: {[1x100 double]}<br></pre>
A similar behavior is obtained when setting constraints as a structure
with a <span style="font-style: italic;">fixed</span> member :<br>
<pre style="margin-left: 40px;">&gt;&gt; constraints.fixed = [ <span
 style="color: rgb(255, 0, 0);">1</span> 0 0 0 ];<br></pre>
The <span style="font-style: italic;">constraints</span> vector should
have the same length as the model parameter vector.<br>
<h4><a class="mozTocH4" name="mozTocId871054"></a>Parameters varying
within limits</h4>
If one needs to restrict the exploration range of parameters, it is
possible to define the lower and upper bounds of the model parameters.
This can be done by setting the 5th fits argument to the lower bounds<span
 style="font-style: italic;"> lb</span>, and the 6th to the upper <span
 style="font-style: italic;">ub</span>, e.g. :<br>
<pre style="margin-left: 40px;">&gt;&gt; a=<span
 style="color: rgb(51, 102, 255);">load</span>(iData, <span
 style="color: rgb(204, 51, 204);">[ ifitpath 'Data/sv1850.scn' ]</span>)<br>&gt;&gt; p=<span
 style="color: rgb(51, 102, 255);">fits</span>(a, <span
 style="color: rgb(204, 51, 204);">'gauss'</span>, [], <span
 style="color: rgb(204, 51, 204);">'fminimfil'</span>, <span
 style="color: rgb(255, 0, 0);">[ 0.5 0.8 0 0 ], [ 1 1.2 1 1 ]</span>)</pre>
A similar behavior is obtained by setting constraints as a structure
with members <span style="font-style: italic;">min</span> and <span
 style="font-style: italic;">max</span> :<br>
<pre style="margin-left: 40px;">&gt;&gt; constraints.min = <span
 style="color: rgb(255, 0, 0);">[ 0.5 0.8 0 0 ]</span>;<br>&gt;&gt; constraints.max = <span
 style="color: rgb(255, 0, 0);">[ 1 1.2 1 1 ]</span>;<br></pre>
The <span style="font-style: italic;">constraints</span> vectors
should have the same length as the model parameter vector.<br>
<span style="font-style: italic;"></span>
<h4><a class="mozTocH4" name="mozTocId673530"></a>Limiting parameter
change<br>
</h4>
Last, it is possible to restrict the change rate of parameters by
assigning the <span style="font-style: italic;">constraints.steps</span>
field to a vector. Each non-zero value then specifies the absolute
change that the corresponding parameter can vary between two optimizer
iterations.<br>
<br>
In short, the constraints structure can have the following members,
which all should have the same length as the model parameter vector:<br>
<ul>
  <li><span style="font-style: italic;">constraints.fixed: </span>1
for fixed parameter, 0 for free parameters<br>
  </li>
  <li><span style="font-style: italic;">constraints.min: </span>the
minimum value for each parameter. -Inf is supported.<br>
  </li>
  <li><span style="font-style: italic;">constraints.max: </span>the
maximum value for each parameter. +Inf is supported.</li>
  <li><span style="font-style: italic;">constraints.steps: </span>the
maximum change between iterations for each parameter. +Inf is supported.</li>
</ul>
All these constraints may be used simultaneously.<br>
<h3 style="text-align: center;"><a class="mozTocH3"
 name="mozTocId179895"></a>Estimating the model parameter uncertainties</h3>
Currently, the <span style="font-style: italic;">iFit</span> suite
does not provide a simple way to estimate the parameter uncertainty
associated with a fit result. However, the <span
 style="font-style: italic;">output.parsHistory</span> and <span
 style="font-style: italic;">output.criteriaHistory</span> can provide
an estimate of the parameter tolerance around the found fit solution. <br>
<br>
If one sets a criteria tolerance, say +100 % around the optimal
solution (that is 2*sigma), then we can search for all parameter sets
used during the optimization that satisfy this uncertainty relation,
and compute the corresponding standard deviation of the parameter
distributions :<br>
<pre style="margin-left: 40px;">&gt;&gt; a=<span
 style="color: rgb(51, 102, 255);">load</span>(iData, <span
 style="color: rgb(204, 51, 204);">[ ifitpath 'Data/sv1850.scn' ]</span>)<br>&gt;&gt; [p,criteria,message,output]= <span
 style="color: rgb(51, 102, 255);">fits</span>(a, <span
 style="color: rgb(204, 51, 204);">'gauss'</span>, [], <span
 style="color: rgb(204, 51, 204);">'fminimfil'</span>);<br>&gt;&gt; index=<span
 style="color: rgb(51, 102, 255);">find</span>(output.criteriaHistory &lt; min(output.criteriaHistory)*2);   <span
 style="font-style: italic;">% identify tolerance region +50 % around optimum</span><br>&gt;&gt; sigma = <span
 style="color: rgb(51, 102, 255);">std</span>(output.parsHistory(index,:));                             <span
 style="font-style: italic;">% compute standard deviation for these parameter sets</span><br>&gt;&gt; <span
 style="color: rgb(51, 102, 255);">num2str</span>([p ; sigma], 4)                                               <span
 style="font-style: italic;">% display parameters and their uncertainty</span> +/-<br>ans =<br><br>  0.6264      1.001   -0.00365  0.0002173<br>0.004565  2.438e-05  3.159e-05  3.785e-05<br></pre>
This method relies on the fact that a significant number of parameter
sets and criteria evaluations must have been performed in the vicinity
of the final best fit. The choice of the tolerance region is also
important, but a +100% extent is probably realistic in most cases.<br>
<h3 style="text-align: center;"><a class="mozTocH3"
 name="mozTocId855522"></a>Building model functions</h3>
<br>
<h3 style="text-align: center;"><a class="mozTocH3"
 name="mozTocId778987"></a>Specifying the optimization criteria</h3>
<br>
<hr style="width: 100%; height: 2px;">
<div style="text-align: center;"><span style="font-style: italic;">E.
Farhi - iFit/iData fitting - </span><span style="font-style: italic;">$Date:
2010-11-22 14:15:30$ $Revision: 1.7 $
</span><span style="font-style: italic;"> </span>- back to <a
 href="index.html">Main iFit Page</a>
</div>
</body>
</html>
