<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <title>iFit: Data Treatment</title>
    <meta http-equiv="content-type" content="text/html;
      charset=windows-1252">
  </head>
  <body>
    <h1 style="text-align: center;"><a class="mozTocH1"
        name="mozTocId647835"></a>iFit: Data Treatment procedures<br>
    </h1>
    <br>
    <ol id="mozToc">
      <!--mozToc h2 1 h3 2 h4 3 h5 4 h5 5 h6 6-->
      <li><a href="#mozTocId664163">Neutron scattering Dynamic structure
          factor</a>
        <ol>
          <li><a href="#mozTocId424180">Isotropic dynamic structure
              factors S(|q|,w) in liquids, powders, gas, polymers and
              other amorphous materials</a>
            <ol>
              <li><a href="#mozTocId550398">Example: dynamic structure
                  factor from molecular dynamics</a></li>
              <li><a href="#mozTocId633075">Example: dynamic structure
                  factor from a neutron scattering experiment </a></li>
              <li><a href="#mozTocId986651">References</a></li>
            </ol>
          </li>
        </ol>
      </li>
      <li><a href="#mozTocId415079">Neutron scattering cross section </a></li>
    </ol>
    <hr style="width: 100%; height: 2px;">
    <div style="text-align: center;">Commands we use in this page: <span
        style="font-style: italic;">iData, <a href="Load.html">load</a>,
        <a href="Save.html">save</a>, <a href="Math.html">Math</a>, </span><a
        href="Methods.html">methods</a>
      <div style="text-align: left;"><br>
        <h2><a class="mozTocH3" name="mozTocId664163"></a>Neutron
          scattering Dynamic structure factor<br>
        </h2>
        The iFit infrastructure comes with a set of dedicated procedures
        to read and analyze S(q,w) dynamic structure factors, aka
        scattering law, in the case of <a
          href="https://en.wikipedia.org/wiki/Inelastic_neutron_scattering">neutron







          scattering</a> [5,6].<br>
        <br>
        <h3><a class="mozTocH3" name="mozTocId424180"></a>Isotropic
          dynamic structure factors S(|q|,w) in liquids, powders, gas,
          polymers and other amorphous materials</h3>
        The following procedures apply to 2D S(q,w), i.e. those that are
        obtained by averaging the S(q,w) over |q| in isotropic density
        materials.<br>
        In the following, S* is a symmetric dynamic structure factor,
        whereas S(q,w) denotes the non-symmetric dynamic structure
        factor which contains the population factor (e.g. Bose for
        phonons). All routines assume the wavevector 'q' is given in
        [Angs<sup>-1</sup>] and the energy is given in [meV].<br>
        <br>
        <div align="center">1 meV = 241.8 GHz = 11.604 K = 0.0965 kJ/mol<br>
          1 Angs<sup>-1</sup> = 10 nm<sup>-1</sup><br>
        </div>
        <br>
        <table border="1" cellpadding="2" cellspacing="2" width="100%">
          <tbody>
            <tr>
              <td valign="top"><i><b>Procedure</b></i><i><b><br>
                  </b></i></td>
              <td valign="top"><i><b>Input</b></i><i><b><br>
                  </b></i></td>
              <td valign="top"><i><b>Output</b></i><i><b><br>
                  </b></i></td>
              <td valign="top"><i><b>Description</b></i><i><b><br>
                  </b></i></td>
            </tr>
            <tr>
              <td valign="top"><b>Sqw=load</b><b>(iData,file)</b><b><br>
                </b></td>
              <td valign="top">file<br>
              </td>
              <td valign="top">iData<br>
              </td>
              <td valign="top">import any S(q,w) as generated by e.g.
                LAMP and nMoldyn/MDANSE.<br>
              </td>
            </tr>
            <tr>
              <td valign="top"><b>Sqw_symmetrize</b><b>(Sqw)</b><b><br>
                </b></td>
              <td valign="top">S*(|q|,w&gt;0)<br>
              </td>
              <td valign="top">S*(|q|,w)=S*(|q|,-w)<i><br>
                </i></td>
              <td valign="top">extend the S(|q|,w) in both energy sides.
                The initial data set should better be 'classical'.<br>
              </td>
            </tr>
            <tr>
              <td valign="top"><b>Sqw_Bosify</b><b>(Sqw,T)</b><b><br>
                </b></td>
              <td valign="top">S*(|q|,w)</td>
              <td valign="top">S(|q|,w)</td>
              <td valign="top">convert a symmetric scattering law (aka
                classical, for instance from Molecular Dynamics) into a
                'quantum' scattering law (non symmetric, for instance
                from neutron and X-ray inelastic scattering experiment)<br>
              </td>
            </tr>
            <tr>
              <td valign="top"><b>Sqw_deBosify</b><b>(Sqw,T)</b><b><br>
                </b></td>
              <td valign="top">S(|q|,w)</td>
              <td valign="top">S*(|q|,w)</td>
              <td valign="top">convert a 'quantum' scattering law (non
                symmetric, for instance from neutron and X-ray inelastic
                scattering experiment) into a symmetric scattering law
                (aka classical, for instance from Molecular Dynamics)<br>
              </td>
            </tr>
            <tr>
              <td valign="top"><b>trapz(Sqw)</b><b><br>
                </b></td>
              <td valign="top">S(|q|,w)</td>
              <td valign="top">S(|q|)<br>
              </td>
              <td valign="top">compute the static structure factor.<br>
              </td>
            </tr>
            <tr>
              <td valign="top"><b>Sqw_dynamic_range</b><b>(Sqw,Ei)</b><b><br>
                </b></td>
              <td valign="top">S(|q|,w)</td>
              <td valign="top">measurable S(|q|,w) for Ei<br>
              </td>
              <td valign="top">restrict the dynamic structure factor to
                the measurable one for an incoming energy Ei [meV]. The
                detection angular range can be set as 3rd argument.<br>
              </td>
            </tr>
            <tr>
              <td valign="top"><b>Sqw_</b><b>scatt_xs</b><b>(Sqw,Ei)</b><b><br>
                </b></td>
              <td valign="top">S(|q|,w)</td>
              <td valign="top">&#8747;&#8747;S(q,w)q dq dw /2Ki² </td>
              <td valign="top">compute the total scattering cross
                section which is the integral of S(q,w) over the dynamic
                range vs. incident neutron energy.<br>
              </td>
            </tr>
          </tbody>
        </table>
        <br>
        Conventions:<br>
        <ul>
          <li>w = Ei-Ef = energy lost by the neutron in meV.<br>
          </li>
          <li>w &gt; 0, neutron looses energy, can not be higher than
            the incident neutron energy (Stokes)</li>
          <li>w &lt; 0, neutron gains energy, anti-Stokes</li>
          <li>q is the momentum in Angs-1.<br>
          </li>
        </ul>
        <h4><a class="mozTocH4" name="mozTocId550398"></a>Example:
          dynamic structure factor from molecular dynamics</h4>
        <br>
        We import the data, obtained from an <i>ab-initio</i> Molecular
        Dynamics (AIMD) with VASP, for 200 Ge atoms (GGA-PW91 potential)
        at T=1350K, from [7]. The data set is part of iFit, as well as <a
href="https://github.com/McStasMcXtrace/McCode/blob/master/mcstas-comps/data/Ge_liq_coh.sqw">in







          McStas</a>. You can also try liquid Rubidium from <a
href="https://github.com/McStasMcXtrace/McCode/blob/master/mcstas-comps/data/Rb_liq_coh.sqw">here</a>
        [8] and heavy water from <a
href="https://github.com/McStasMcXtrace/McCode/blob/master/mcstas-comps/data/D2O_liq_290_coh.sqw">here</a>
        [9]. This is the coherent symmetric scattering law:<br>
        <ul>
          <li>Sqw=<font color="#3366ff">load</font>(iData,
            fullfile(ifitpath,<font color="#cc33cc">'Data','SQW_coh_lGe.nc'</font>))</li>
        </ul>
        Molecular Dynamics trajectories are usually computed in the NVE
        <a href="https://en.wikipedia.org/wiki/Microcanonical_ensemble">micro-canonical







          ensemble</a>. The integrator used along the trajectory is the
        <a href="https://en.wikipedia.org/wiki/Verlet_integration">Verlet</a>,
        which is a central difference, energy conserving integrator. As
        a consequence, the time evolution is symmetric (i.e.
        trajectories can be read in positive or negative time steps
        without changing the system behaviour). This implies that the
        derived intermediate scattering function <i>F(q,t)</i> is real,
        symmetric in time, and as a consequence <i>S(q,w)</i> is also
        real, symmetric in energy. We denote this scattering law S* to
        label it as symmetric.<img alt="Treatment_Sqw_load"
          title="Treatment_Sqw_load" src="images/Treatment_Sqw_load.png"
          align="right" width="200" height="180"> It is often named
        'classical'.<br>
        <br>
        We plot the scattering law S*:<br>
        <ul>
          <li><font color="#3366ff">plot</font>(log10(Sqw), <font
              color="#cc33cc">'view3'</font>);</li>
        </ul>
        Then we need to symmetrize the data set, as it comes defined
        only in w&gt;=0. This procedure applies to a 'classical'
        symmetric S*(q,w). If the scattering law you have already
        extends on both energy sides, you can skip this step (e.g.
        nMoldyn4/MDANSE).<br>
        <ul>
          <li>Sqw2=<font color="#3366ff">Sqw_symmetrize</font>(Sqw)</li>
        </ul>
        Then we can plot the symmetrized scattering law, which extends
        equally in both w&lt;0 and w&gt;0.<img
          alt="Treatment_Sqw_symmetrize"
          title="Treatment_Sqw_symmetrize"
          src="images/Treatment_Sqw_symmetrize.png" align="right"
          width="200" height="180"><br>
        <ul>
          <li><font color="#3366ff">plot</font>(log10(Sqw2), <font
              color="#cc33cc">'view3'</font>);</li>
        </ul>
        We can check here that S*(q,-w) = S*(q,w).<br>
        <br>
        <b>From classical to quantum scattering law</b><br>
        The next step is to get the temperature in. <font
          color="#ff0000"><br>
          <br>
          A warning is in place here</font>. There is only one S(q,w),
        but there are infinite ways to derive a symmetrized S*(q,w). So,
        having obtained S* from Molecular Dynamics, we have to choose <i>how</i>
        to 'desymmetrize' it in order to obey the so-called 'detailed
        balance' accounting for the population of vibrational modes
        [5,6]:<br>
        <br>
        <div align="center">S(q,w)&nbsp; = exp(hw/kT) S(q,-w)<br>
        </div>
        <br>
        This step is performed by the <font color="#3366ff">Sqw_Bosify</font>
        procedure, which can use 3 different 'quantum corrections' to go
        from a classical/symmetric S*(q,w) data set to a 'real/quantum'
        scattering law.<br>
        <br>
        <div align="center">S(q,w)&nbsp; = Q(w) S*(q,w) with
          S*=classical limit<br>
        </div>
        <br>
        The semi-classical correction, Q, aka 'quantum' correction
        factor,&nbsp; can be selected as [4]:<br>
        <br>
        <table border="1" cellpadding="2" cellspacing="2" width="100%">
          <tbody>
            <tr>
              <td valign="top"><i>Q = exp(hw/kT/2)</i></td>
              <td valign="top">'Schofield' or 'Boltzmann' [1]</td>
            </tr>
            <tr>
              <td valign="top"><i>Q = hw_kT./(1-exp(-hw/kT))</i> <br>
              </td>
              <td valign="top"> 'harmonic'&nbsp; or 'Bader' [2]</td>
            </tr>
            <tr>
              <td valign="top"><i>Q = 2./(1+exp(-hw/kT))</i> <br>
              </td>
              <td valign="top">'standard'&nbsp; or 'Frommhold' [3]. This
                is the default.</td>
            </tr>
          </tbody>
        </table>
        <br>
        where <i>hw</i> is the energy (in meV), and <i>k</i> is the
        Boltzmann constant. <br>
        <br>
        Even though the <i>'Boltzmann'</i> correction is the most
        natural correction, as it directly derives from the detailed
        balance, it is not recommended as it leads to a divergence of
        the S(q,w) for large energies e.g. above few 100 meV. The <i>'harmonic'</i>
        correction is weaker but does not fully avoid the divergence at
        large energies. The <i>'standard</i>' correction is probably
        the best when dealing with large neutron energies. In the
        'classical' limit where hw &lt;&lt; kT (and kT ~ 30 meV a 300K),
        all corrections are equivalent. All these corrections satisfy
        the detailed balance equally.<br>
        <br>
        So, from the symmetric 'classical' S* we can now determine the
        'true' S(q,w) scattering law, at a given temperature, using the
        'standard' quantum correction.<br>
        <ul>
          <li>SqwT = <font color="#3366ff">Sqw_Bosify</font>(Sqw2,
            1250)</li>
          <li> <font color="#3366ff">plot</font>(log10(SqwT));</li>
        </ul>
        <img alt="Treatment_Sqw_dynrange.png"
          title="Treatment_Sqw_dynrange.png"
          src="images/Treatment_Sqw_dynrange.png" align="right"
          width="200" height="180">When not given, the temperature will
        be searched in the Sqw data set. A 3rd argument allows to
        specify the quantum correction to apply (<i>'standard'</i> is
        default). Of course, in this example, for such a high
        temperature, the up- and down-scattering are about the same (the
        quantum correction remains close to 1). For materials at low
        temperatures, the two sides are highly disymmetric.<br>
        <br>
        <b>Dynamic range accessible for a given neutron incident energy,
          structure factor, inelasticity correction</b><br>
        Then, we can determine the dynamic range accessible to neutrons
        with a given incident energy, say Ei=25 meV.<br>
        <ul>
          <li>Sqw25 = <font color="#3366ff">Sqw_dynamic_range</font>(SqwT,





            25)</li>
          <li> <font color="#3366ff">plot</font>(log10(Sqw25));</li>
        </ul>
        It is here possible to compare the structure factor as measured
        with Ei=25 meV (i.e. restricted to the corresponding dynamic
        range) to the ideal one. The ratio is called the "inelasticity
        correction".<br>
        <ul>
          <li><font color="#3366ff">plot</font>(SqwT, <font
              color="#3366ff">trapz</font>(Sqw25));</li>
        </ul>
        <b><img alt="Treatment_Sqw_moments"
            title="Treatment_Sqw_moments"
            src="images/Treatment_Sqw_moments.png" align="right"
            width="200" height="150"></b><b>Characteristic frequencies</b><br>
        From the dynamic structure factor, one can compute the energy
        moments, which provide some of the characteristic frequencies
        [5,6], specifying the molar weight of the scattering units (here
        72.64 g/mol for Ge):<br>
        <ul>
          <li>moments=<font color="#3366ff">Sqw_moments</font>(SqwT,
            72.64)</li>
          <li><font color="#3366ff">plot</font>(moments)<br>
          </li>
        </ul>
        <b>The density of states (aka phonon or frequency spectrum)</b><br>
        The scattering law, from its definition [5,6], is a correlation
        function of the density operator, which itself depends on the <i>position</i>
        of the particles. <br>
        The vibrational density of states is defined as the <i>velocity</i>
        auto-correlation function (VACF) of the particles. It is not a
        function of the positions. So, in principle, it is NOT possible
        to compute the vibrational density of states from the scattering
        law.<br>
        <br>
        However, a few attempts have been made to estimate the density
        of states from e.g. a neutron scattering time-of-flight
        experiment (such as done on IN4, IN5 and IN6 at the ILL). The
        concept of the <i>generalised density of states</i> has been
        defined as:<br>
        <div align="center">gDOS(q,w) = S(q,w) w/q<sup>2</sup> [1 -
          exp(-hw/kT)]<br>
        </div>
        <br>
        which is exact in the case of an incoherent scatterer. As such,
        it should only be considered as an approximation of the density
        of states, especially for most materials which have coherent
        scattering. The hydrogenated materials and e.g Vanadium are good
        examples of materials which are mostly incoherent, and the
        approximation is then good. For other materials, great care
        should be taken.<br>
        <br>
        We import the heavy water from <a
href="https://github.com/McStasMcXtrace/McCode/blob/master/mcstas-comps/data/D2O_liq_290_coh.sqw">here</a>
        [9]. <br>
        <ul>
          <li>Sqw=<font color="#3366ff">iData</font>(<font
              color="#cc33cc">'D2O_liq_290_coh.sqw'</font>);</li>
        </ul>
        <img alt="Treatment_Sqw_gDOS" title="Treatment_Sqw_gDOS"
          src="images/Treatment_Sqw_gDOS.png" align="right" width="200"
          height="151">Then we can compute the generalised density of
        states with the <font color="#3366ff">Sqw_gDOS</font>
        procedure, from either the raw, or the symmetrised, 'Bosified'
        (with quantum correction) data set.<br>
        <ul>
          <li>SqwT = <font color="#3366ff">Sqw_Bosify</font>(<font
              color="#3366ff">Sqw_symmetrize</font>(Sqw), 290);</li>
          <li>g=[ <font color="#3366ff">Sqw_gDOS</font>(Sqw) <font
              color="#3366ff">Sqw_gDOS</font>(SqwT) ];</li>
        </ul>
        This is a function of (q,w), and should then be integrated along
        the wavevector axis (2) to derive the frequency spectrum.<br>
        <ul>
          <li><font color="#3366ff">plot</font>(<font color="#3366ff">trapz</font>(g,2))</li>
        </ul>
        <h4><a class="mozTocH4" name="mozTocId633075"></a>Example:
          dynamic structure factor from a neutron scattering experiment<br>
        </h4>
        The symmetrization step is not needed if you import experimental
        S(q,w) as measured on inelastic neutron scattering spectrometers
        such as <a
href="https://www.ill.eu/instruments-support/instruments-groups/instruments/in5">IN5@ILL</a>.
        This type of data set already 'contains' the Bose factor
        accounting for the population of modes.<br>
        <br>
        Then the sequence of operations is first to <font
          color="#3366ff">load</font> the data set, then apply the <font
          color="#3366ff">Sqw_deBosify</font> procedure, specifying the
        temperature if it is not defined in the data set. Then <font
          color="#3366ff">Sqw_symmetrize</font> can be applied to derive
        a symmetric data set which extends in both w&gt;0and w&lt;0. The
        data close to the elastic w=0 line, which can be measured in up-
        and down- scattering, is computed as the mean of both sides.<br>
        <br>
        Then, the rest of the data treatment is the same as above.<br>
        <h4><a class="mozTocH4" name="mozTocId986651"></a>References</h4>
        <ol>
          <li>P. Schofield. <i>Phys. Rev. Lett</i>., 4, 239 (1960).<br>
          </li>
          <li>J. S. Bader and B. J. Berne. <i>J. Chem. Phys.,</i> 100,
            8359 (1994) ; see also T. D. Hone and G. A. Voth.<i> J.
              Chem. Phys.</i>, 121, 6412 (2004).<br>
          </li>
          <li>L. Frommhold. Collision-induced absorption in gases, 1 st
            ed., Cambridge Monographs on Atomic, Molecular, and Chemical
            Physics, Vol. 2, Cambridge Univ. Press: London (1993).</li>
          <li>B. Hehr, <a
              href="http://www.lib.ncsu.edu/resolver/1840.16/7422">http://www.lib.ncsu.edu/resolver/1840.16/7422</a>
            PhD manuscript (2010).</li>
          <li>Helmut Schober, <i>Journal of Neutron Research</i> 17
            (2014) pp. 109-357&lt;<a
              href="http://dx.doi.org/10.3233/JNR-140016">http://dx.doi.org/10.3233/JNR-140016</a>&gt;</li>
          <li>G.L. Squires, <span id="productTitle"
              class="a-size-large">Introduction to the Theory of Thermal
              Neutron Scattering, </span>Dover Publications Inc.(1997)</li>
          <li>Hugouvieux V, Farhi E, Johnson MR, et al., <i>PRB</i> <b>75</b>
            (2007) 104208</li>
          <li>E. Farhi, V. Hugouvieux, M.R. Johnson, W. Kob, <i>Journal
              of Computational Physics</i><b> 228</b> (2009) 5251<br>
          </li>
          <li>E. Farhi et al, <i>J. Nucl. Sci. Tech. </i><b>52</b>
            (2015) 844; DOI: 10.1080/00223131.2014.984002</li>
          <li>NIST Neutron scattering lengths and cross sections &lt;<a
              href="https://www.ncnr.nist.gov/resources/n-lengths/">https://www.ncnr.nist.gov/resources/n-lengths/</a>&gt;</li>
          <li>Price J. et al, Non Cryst Sol 92 (1987) 153</li>
          <li>Bellisent-Funel et al, J. Mol. Struct. 250 (1991) 213</li>
        </ol>
        <h2><a class="mozTocH3" name="mozTocId415079"></a>Neutron
          scattering cross section </h2>
        <p>The energy dependent scattering cross section is computed as
          the integral of the dynamic range vs. the incident energy:<br>
          <br>
        </p>
        <div align="center">&#963;(Ei) = &#963;&#8747;&#8747;S(q,w)q dq dw /2Ki² <br>
        </div>
        <br>
        <img alt="Treatment_Sqw_XS.png" title="Treatment_Sqw_XS.png"
          src="file:///home/farhi/dev/iFit/Docs/images/Treatment_Sqw_XS.png"
          align="right" width="200" height="180">The integral can be
        computed with the <font color="#3366ff">Sqw_scatt_xs</font>
        procedure, for a given energy range, which should then be
        multiplied by the bound thermal scattering cross section &#963;,
        which is 8.42 barns for the coherent scattering in Ge [10]:<br>
        <ul>
          <li>Ei = <font color="#3366ff">logspace</font>(-3,2,50);%
            from Ei=10<sup>-3</sup> to 10<sup>2</sup> meV.<br>
          </li>
          <li>XS = <font color="#3366ff"><font color="#330033">8.42*</font>Sqw_scatt_xs</font>(SqwT,Ei);</li>
          <li>plot(XS); set(gca, <font color="#cc33cc">'YScale','log','XScale','log'</font>);</li>
        </ul>
      </div>
    </div>
    <hr style="width: 100%; height: 2px;">
    <div style="text-align: center;"><span style="font-style: italic;">E.
Farhi
























        - iFit/iData loading data - </span><span style="font-style:
        italic;"> $Date$ $Revision$ </span><span style="font-style:
        italic;"> </span>- back to <a href="index.html">Main iFit Page
      </a><a href="http://www.ill.eu/"><img title="ILL, Grenoble, France
          &lt;www.ill.eu&gt;" src="images/ILL-web-jpeg.jpg" alt="ILL,
          Grenoble, France &lt;www.ill.eu&gt;" style="border: 0px solid
          ; width: 53px; height: 50px;" align="right"></a> </div>
  </body>
</html>
