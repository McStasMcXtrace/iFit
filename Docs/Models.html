<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <meta http-equiv="content-type" content="text/html;
      charset=windows-1252">
    <title>iFit: Models model functions</title>
  </head>
  <body>
    <h1 style="text-align: center;"><a class="mozTocH1"
        name="mozTocId294096"></a>iFit: Models (fit models)</h1>
    <br>
    <ol id="mozToc">
      <!--mozToc h3 1 h4 2 h3 3 h4 4 h5 5 h6 6-->
      <li><a href="#mozTocId147615">How to use models </a></li>
      <li><a href="#mozTocId96090">List of default fit models</a></li>
      <li><a href="#mozTocId285330">Specialized models</a>
        <ol>
          <li><a href="#mozTocId597620">Scattering models (neutrons,
              x-rays)</a></li>
          <li><a href="#mozTocId344379"> Powder structure refinement
              (Rietveld)</a></li>
          <li><a href="#mozTocId677670">Phonon/spin-wave dispersion</a></li>
          <li><a href="#mozTocId226848">Phonon dispersion in perovskites</a></li>
          <li><a href="#mozTocId885605">Acoustic phonon dispersion in
              mono-atomic cubic crystal</a></li>
          <li><a href="#mozTocId881911"> Phonon dispersion from
              ab-initio force estimate and dynamical matrix using
              PHON/QuantumEspresso </a></li>
          <li><a href="#mozTocId990577">Phonon dispersion from ab-initio
              force estimate and dynamical matrix using ASE</a></li>
        </ol>
      </li>
      <li><a href="#mozTocId810939">Model builder: defining a new model
          easy</a>
        <ol>
          <li><a href="#mozTocId775891">Creating complex functions from
              simple functions</a></li>
          <li><a href="#mozTocId937554">Using signal
              convolution/correlation in new functions</a></li>
        </ol>
      </li>
      <li><a href="#mozTocId854762">How to write manually a model
          function</a></li>
    </ol>
    <br>
    <hr style="width: 100%; height: 2px;">
    <div style="text-align: center;">Commands we use in this page: <span
        style="font-style: italic;">fits, <a href="#mozTocId775891">ifitmakefunc,






















        </a>fits(iData)</span>, <a href="iFunc.html">iFunc</a><br>
    </div>
    <br>
    <h3><a class="mozTocH3" name="mozTocId147615"></a>How to use models<br>
    </h3>
    Models are numerical functions, that take input axes and a parameter
    set, and return a function evaluation. <br>
    <br>
    Such models are defined as <a href="iFunc.html">iFunc</a> objects,
    and used in iFit when there is a need to e.g. compute and plot a
    function evaluation corresponding with the axes of an iData object.
    Similarly, this function evaluation can be used iteratively in an
    optimization process in order to find a parameter set that matches
    best the iData object Signal, using the <span style="font-weight:
      bold;">fits</span> method (refer to the <a href="Fit.html">Fit</a>
    page).<br>
    <br>
    Models can be used in the following ways (for instance 'model' may
    be 'gauss'):<br>
    <pre style="margin-left: 40px;">&gt;&gt; <span style="color: rgb(51, 102, 255);">model</span>		<span style="font-style: italic;">% display model information</span><br>&gt;&gt; <span style="color: rgb(51, 102, 255);">disp(model</span>)		<span style="font-style: italic;">% idem, extensive information</span><br>&gt;&gt; <span style="color: rgb(51, 102, 255);">plot(model</span><span style="color: rgb(204, 51, 204);"></span>)	<span style="font-style: italic;">	% plot the model with its default settings</span><span style="color: rgb(255, 0, 0); font-style: italic;"></span><br>&gt;&gt; <span style="color: rgb(51, 102, 255);">model</span>(p, x, y ...)	<span style="font-style: italic;">% evaluate the model with parameters p, and axes x,y,...<br>&gt;&gt; </span><span style="color: rgb(51, 102, 255);">model</span>([], x, y ...)	<span style="font-style: italic;">% evaluate the model with axes x,y,... and automatic parameter guess<br></span><span style="font-style: italic;">&gt;&gt; </span><span style="color: rgb(51, 102, 255);">model</span>(<span style="color: rgb(204, 51, 204);">'guess'</span>, x, y ...)	% idem<br>&gt;&gt; <span style="color: rgb(51, 102, 255);"></span>a(model, p)	<span style="font-style: italic;">	% evaluate the model onto the iData object 'a' axes with parameters p<br>&gt;&gt; </span><span style="color: rgb(51, 102, 255);">fits</span>(a, model, p)	<span style="font-style: italic;">% fit the model onto the iData object</span><br>&gt;&gt; <span style="color: rgb(51, 102, 255);">fits</span>(model, a, p)	<span style="font-style: italic;">% same as above<br></span><span style="font-style: italic;"></span><br></pre>
    To create a model, use the <a href="#mozTocId775891">ifitmakefunc</a>
    dialogue window (see below), or instantiate an <a href="iFunc.html">iFunc</a>
    object.<br>
    <pre style="margin-left: 40px;">&gt;&gt; model = gauss;<br>&gt;&gt; model = <span style="color: rgb(51, 102, 255);">iFunc</span>(<span style="color: rgb(204, 51, 204);">'p(1)*x+p(2)'</span>)<br>&gt;&gt; model = <span style="color: rgb(51, 102, 255);">iFunc</span>(<span style="color: rgb(204, 51, 204);">'a=p(1); b=p(2); signal=a*x+b'</span>) <br></pre>
    You can edit their code to see how to define new models:<br>
    <pre style="margin-left: 40px;">&gt;&gt; <span style="color: rgb(51, 102, 255);">edit</span> gauss <span style="font-style: italic;">% edit the function definition (from a file)</span><br>&gt;&gt; <span style="color: rgb(51, 102, 255);">edit</span> voigt<br>&gt;&gt; <span style="color: rgb(51, 102, 255);">edit</span>(voig) <span style="font-style: italic;">% edit the object definition</span><br></pre>
    <pre style="margin-left: 40px;"><span style="font-style: italic;"></span></pre>
    <h3><a class="mozTocH3" name="mozTocId96090"></a><span
        style="font-weight: bold;">List of default fit models</span></h3>
    The 1D functions are <span style="font-style: italic;">signal=f(parameters,






















      x)</span>, and the 2D functions are <span style="font-style:
      italic;">signal=f(parameters, x, y)</span>.<br>
    <span style="font-style: italic; font-weight: bold;"><br>
    </span>
    <table style="text-align: left; width: 1016px; height: 1301px;"
      border="1" cellpadding="2" cellspacing="2">
      <tbody>
        <tr>
          <td style="vertical-align: top; font-weight: bold; font-style:
            italic; color: rgb(51, 102, 255); background-color: rgb(255,
            204, 204);">Function<br>
          </td>
          <td style="vertical-align: top; background-color: rgb(255,
            204, 204);"><span style="font-style: italic; font-weight:
              bold; color: rgb(51, 102, 255);">Description</span><br>
          </td>
          <td style="vertical-align: top; font-weight: bold; font-style:
            italic; color: rgb(51, 102, 255); background-color: rgb(255,
            204, 204);">Dimensionality<br>
          </td>
          <td style="vertical-align: top; font-weight: bold; font-style:
            italic; color: rgb(51, 102, 255); background-color: rgb(255,
            204, 204);">Parameters<br>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top; font-weight: bold;">allometric<br>
          </td>
          <td style="vertical-align: top;">Allometric (power/asymptotic
            law)<br>
          </td>
          <td style="vertical-align: top; color: rgb(51, 204, 0);">1D<br>
          </td>
          <td style="vertical-align: top;">Amplitude Offset Exponent
            BackGround<br>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top;"><span style="font-weight:
              bold;">bigauss</span><br>
          </td>
          <td style="vertical-align: top;">Asymmetric Gaussian<br>
          </td>
          <td style="vertical-align: top; color: rgb(51, 204, 0);">1D</td>
          <td style="vertical-align: top;">Amplitude Centre HalfWidth1
            HalfWidth2 Background</td>
        </tr>
        <tr>
          <td style="vertical-align: top;"><span style="font-weight:
              bold;">bilorz</span><br>
          </td>
          <td style="vertical-align: top;">Asymmetric Lorentzian<br>
          </td>
          <td style="vertical-align: top; color: rgb(51, 204, 0);">1D</td>
          <td style="vertical-align: top;">Amplitude Centre HalfWidth1
            HalfWidth2 Background</td>
        </tr>
        <tr>
          <td style="vertical-align: top; color: rgb(0, 0, 0);
            font-weight: bold;">bose</td>
          <td style="vertical-align: top;">Bose factor<br>
          </td>
          <td style="vertical-align: top; color: rgb(51, 204, 0);">1D</td>
          <td style="vertical-align: top;">Tau <span style="font-style:
              italic;">[h/2pi/kT] in "x" units</span><br>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top; font-weight: bold;">dho<br>
          </td>
          <td style="vertical-align: top;">Damped harmonic oscillator<br>
          </td>
          <td style="vertical-align: top; color: rgb(51, 204, 0);">1D</td>
          <td style="vertical-align: top;">Amplitude Centre HalfWidth
            Background Temperature <span style="font-style: italic;">(in






















              "x" unit)</span><br>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top; font-weight: bold;">dirac<br>
          </td>
          <td style="vertical-align: top;">Dirac peak<br>
          </td>
          <td style="vertical-align: top; color: rgb(51, 204, 0);">1D<br>
          </td>
          <td style="vertical-align: top;">Amplitude Centre<br>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top; font-weight: bold;">doseresp<br>
          </td>
          <td style="vertical-align: top;">Dose-response curve with
            variable Hill slope. This is a sigmoid or S-shaped.<br>
          </td>
          <td style="vertical-align: top; color: rgb(51, 204, 0);">1D<br>
          </td>
          <td style="vertical-align: top;">Amplitude Center Slope
            BackGround<br>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top;"><span style="font-weight:
              bold;">expon</span><br>
          </td>
          <td style="vertical-align: top;"><a
              href="http://en.wikipedia.org/wiki/Exponential_decay">Exponential</a>
            decay <img alt="Expon decay" title="Expon decay"
src="https://upload.wikimedia.org/wikipedia/commons/thumb/d/db/Plot-exponential-decay.svg/330px-Plot-exponential-decay.svg.png"
              align="middle" height="75" width="100"><br>
          </td>
          <td style="vertical-align: top; color: rgb(51, 204, 0);">1D<br>
          </td>
          <td style="vertical-align: top;">Amplitude Tau Background<br>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top;"><span style="font-weight:
              bold;">expstretched</span><br>
          </td>
          <td style="vertical-align: top;"><a
              href="http://en.wikipedia.org/wiki/Stretched_exponential_function">Exponential






















              - Stretched</a><img alt="Expon stretched" title="Expon
              stretched"
src="https://upload.wikimedia.org/wikipedia/commons/thumb/4/43/Pibmasterplot.png/1920px-Pibmasterplot.png"
              align="middle" height="75" width="100"><br>
          </td>
          <td style="vertical-align: top; color: rgb(51, 204, 0);">1D<br>
          </td>
          <td style="vertical-align: top;">Amplitude Tau Exponent
            Background<br>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top; color: rgb(0, 0, 0);
            font-weight: bold;">gauss</td>
          <td style="vertical-align: top;"><a
              href="http://en.wikipedia.org/wiki/Gaussian_function">Gaussian</a>
            <img alt="Normal_Distribution" title="Normal_Distribution"
src="https://upload.wikimedia.org/wikipedia/commons/7/74/Normal_Distribution_PDF.svg"
              align="middle" height="75" width="100"><br>
          </td>
          <td style="vertical-align: top; color: rgb(51, 204, 0);">1D</td>
          <td style="vertical-align: top;">Amplitude Centre HalfWidth
            Background<br>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top; font-weight: bold;">green<br>
          </td>
          <td style="vertical-align: top;">Green function<br>
          </td>
          <td style="vertical-align: top; color: rgb(51, 204, 0);">1D<br>
          </td>
          <td style="vertical-align: top;">Amplitude Centre HalfWidth
            Background</td>
        </tr>
        <tr>
          <td style="vertical-align: top;"><span style="font-weight:
              bold;">heaviside</span><br>
          </td>
          <td style="vertical-align: top;">Heaviside (gap)<br>
            <span style="font-style: italic;">The GapSide indicates
              raising (+) or falling (-) gap.</span><br>
          </td>
          <td style="vertical-align: top; color: rgb(51, 204, 0);">1D<br>
          </td>
          <td style="vertical-align: top;">Amplitude Centre GapSide
            Background<br>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top; font-weight: bold;">langevin<br>
          </td>
          <td style="vertical-align: top;">Langevin function for
            magnetic polarization<br>
          </td>
          <td style="vertical-align: top; color: rgb(51, 204, 0);">1D<br>
          </td>
          <td style="vertical-align: top;">Amplitude Center Width
            BackGround<br>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top; font-weight: bold;">laplace<br>
          </td>
          <td style="vertical-align: top;"><a
              href="http://en.wikipedia.org/wiki/Laplace_distribution">Laplace






















              distribution function</a> <img alt="Laplace"
              title="Laplace"
src="https://upload.wikimedia.org/wikipedia/commons/0/0a/Laplace_pdf_mod.svg"
              align="middle" height="75" width="100"><br>
          </td>
          <td style="vertical-align: top; color: rgb(51, 204, 0);">1D<br>
          </td>
          <td style="vertical-align: top;">Amplitude Center Width
            BackGround</td>
        </tr>
        <tr>
          <td style="vertical-align: top; font-weight: bold;">lognormal<br>
          </td>
          <td style="vertical-align: top;"><a
              href="http://en.wikipedia.org/wiki/Log-normal_distribution">Log-Normal






















              distribution</a> <img alt="Log normal" title="Log normal"
src="https://upload.wikimedia.org/wikipedia/commons/a/ae/PDF-log_normal_distributions.svg"
              align="middle" height="100" width="100"><br>
          </td>
          <td style="vertical-align: top; color: rgb(51, 204, 0);">1D<br>
          </td>
          <td style="vertical-align: top;">Amplitude Center Width
            BackGround<br>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top; font-weight: bold;">lorz<br>
          </td>
          <td style="vertical-align: top;"><a
              href="http://en.wikipedia.org/wiki/Lorentzian_function">Lorentzian</a>
            (aka Cauchy) <img alt="lorz" title="lorz"
              src="https://upload.wikimedia.org/wikipedia/commons/8/8c/Cauchy_pdf.svg"
              align="middle" height="80" width="100"> <br>
          </td>
          <td style="vertical-align: top; color: rgb(51, 204, 0);">1D</td>
          <td style="vertical-align: top;">Amplitude Centre HalfWidth
            Background</td>
        </tr>
        <tr>
          <td valign="top"><b>ngauss</b><b><br>
            </b></td>
          <td valign="top">multiple Gaussian<br>
          </td>
          <td valign="top">n*1D<br>
          </td>
          <td valign="top"><br>
          </td>
        </tr>
        <tr>
          <td valign="top"><b>nlorz</b><b><br>
            </b></td>
          <td valign="top">multiple Lorentzian<br>
          </td>
          <td valign="top">n*1D<br>
          </td>
          <td valign="top"><br>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top; font-weight: bold;">pareto<br>
          </td>
          <td style="vertical-align: top;">Pareto distribution function<br>
          </td>
          <td style="vertical-align: top; color: rgb(51, 204, 0);">1D<br>
          </td>
          <td style="vertical-align: top;">Amplitude Exponent Width
            BackGround<br>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top; font-weight: bold;">poisson<br>
          </td>
          <td style="vertical-align: top;">Poisson distribution<br>
            <span style="color: rgb(255, 0, 0);">WARNING:<span
                style="font-style: italic;"> </span></span><span
              style="font-style: italic;">The 'x' axis is assumed to be
              an integer array (counts)</span><br>
          </td>
          <td style="vertical-align: top; color: rgb(51, 204, 0);">1D<br>
          </td>
          <td style="vertical-align: top;">Amplitude Center BackGround<br>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top;"><span style="font-weight:
              bold;">pseudovoigt</span><br>
          </td>
          <td style="vertical-align: top;">Pseudo Voigt<br>
          </td>
          <td style="vertical-align: top;"><span style="color: rgb(51,
              204, 0);">1D</span><br>
          </td>
          <td style="vertical-align: top;">Amplitude Center Width
            BackGround LorentzianRatio<br>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top;"><span style="font-weight:
              bold;">quadline</span><br>
          </td>
          <td style="vertical-align: top;"><a
              href="http://en.wikipedia.org/wiki/Parabola">Quadratic</a>
            line (parabola) <img alt="quad" title="quad"
src="https://upload.wikimedia.org/wikipedia/commons/f/f4/Parts_of_Parabola.svg"
              align="middle" height="82" width="100"><br>
          </td>
          <td style="vertical-align: top; color: rgb(51, 204, 0);">1D<br>
          </td>
          <td style="vertical-align: top;">Quadratic Linear Constant<br>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top;"><span style="font-weight:
              bold;">sigmoid</span><br>
          </td>
          <td style="vertical-align: top;"><a
              href="http://en.wikipedia.org/wiki/Sigmoid_function">Sigmoidal</a>
            S-shaped curve (similar to Dose Response) <img alt="sigmo"
              title="sigmo"
src="https://upload.wikimedia.org/wikipedia/commons/8/88/Logistic-curve.svg"
              align="middle" height="67" width="100"><br>
          </td>
          <td style="vertical-align: top; color: rgb(51, 204, 0);">1D</td>
          <td style="vertical-align: top;">Amplitude Center Width
            BackGround</td>
        </tr>
        <tr>
          <td style="vertical-align: top; font-weight: bold;">sine<br>
          </td>
          <td style="vertical-align: top;"><a
              href="http://en.wikipedia.org/wiki/Sine_function">Sine
              function</a> <img alt="sine" title="sine"
src="https://upload.wikimedia.org/wikipedia/commons/d/d2/Sine_one_period.svg"
              align="middle" height="40" width="100"><br>
          </td>
          <td style="vertical-align: top; color: rgb(51, 204, 0);">1D<br>
          </td>
          <td style="vertical-align: top;">Amplitude Phase_Shift Period
            BackGround<br>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top; font-weight: bold;">sinedamp<br>
          </td>
          <td style="vertical-align: top;"><a
              href="http://en.wikipedia.org/wiki/Damped_sine_wave">Damped






















              Sine function</a> (exponential decay) <img alt="sine_exp"
              title="sine_exp"
              src="https://upload.wikimedia.org/wikipedia/commons/2/25/DampedSine.png"
              align="middle" height="76" width="100"><br>
          </td>
          <td style="vertical-align: top; color: rgb(51, 204, 0);">1D<br>
          </td>
          <td style="vertical-align: top;">Amplitude Phase_Shift Period
            BackGround Decay<br>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top; font-weight: bold;">strline<br>
          </td>
          <td style="vertical-align: top;"><a
              href="http://en.wikipedia.org/wiki/Straight_line">Straight
              line</a> <img alt="line" title="line"
src="https://upload.wikimedia.org/wikipedia/commons/8/86/FuncionLineal01.svg"
              align="middle" height="75" width="100"><br>
          </td>
          <td style="vertical-align: top; color: rgb(51, 204, 0);">1D<br>
          </td>
          <td style="vertical-align: top;">Gradient Background<br>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top; font-weight: bold;">triangl<br>
          </td>
          <td style="vertical-align: top;"><a
              href="http://en.wikipedia.org/wiki/Triangular_function">Triangular</a>
            <img alt="triangle" title="triangle"
src="https://upload.wikimedia.org/wikipedia/commons/c/c8/Triangular_function.svg"
              align="middle" height="70" width="100"><br>
          </td>
          <td style="vertical-align: top; color: rgb(51, 204, 0);">1D</td>
          <td style="vertical-align: top;">Amplitude Centre HalfWidth
            Background</td>
        </tr>
        <tr>
          <td style="vertical-align: top;"><span style="font-weight:
              bold;">tophat</span><br>
          </td>
          <td style="vertical-align: top;"><a
              href="http://en.wikipedia.org/wiki/Rectangular_function">Top-Hat






















              rectangular function</a> <img alt="top hat" title="top
              hat"
src="https://upload.wikimedia.org/wikipedia/commons/1/11/Rectangular_function.svg"
              align="middle" height="69" width="100"><br>
          </td>
          <td style="vertical-align: top; color: rgb(51, 204, 0);">1D</td>
          <td style="vertical-align: top;">Amplitude Centre HalfWidth
            Background</td>
        </tr>
        <tr>
          <td style="vertical-align: top;"><span style="font-weight:
              bold;">twoexp</span><br>
          </td>
          <td style="vertical-align: top;">Two exponential decay
            functions<br>
          </td>
          <td style="vertical-align: top; color: rgb(51, 204, 0);">1D</td>
          <td style="vertical-align: top;">Amplitude1 Tau1 Amplitude2
            Tau2 Background<br>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top; font-weight: bold;">voigt<br>
          </td>
          <td style="vertical-align: top;"><a
              href="http://en.wikipedia.org/wiki/Voigt_profile">Voigt
              function</a> <img alt="voigt" title="voigt"
src="https://upload.wikimedia.org/wikipedia/commons/8/8f/Voigt_distributionPDF.png"
              align="middle" height="75" width="100"><br>
          </td>
          <td style="vertical-align: top; color: rgb(51, 204, 0);">1D<br>
          </td>
          <td style="vertical-align: top;">Amplitude Centre
            HalfWidth_Gauss HalfWidth_Lorz Background<br>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top; font-weight: bold;">gauss2d<br>
          </td>
          <td style="vertical-align: top;"><a
              href="http://en.wikipedia.org/wiki/Gaussian_function">Gaussian</a>
            function with tilt angle <img alt="gauss2d" title="gauss2d"
src="https://upload.wikimedia.org/wikipedia/commons/b/b0/Gaussian_2d_3.svg"
              align="middle" height="75" width="100"><br>
          </td>
          <td style="vertical-align: top;"><span style="color: rgb(51,
              102, 255);">2D</span><br>
          </td>
          <td style="vertical-align: top;">Amplitude Centre_X Center_Y
            HalfWidth_X HalfWidth_Y Angle Background<br>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top; font-weight: bold;">lorz2d<br>
          </td>
          <td style="vertical-align: top;"><a
              href="http://en.wikipedia.org/wiki/Lorentzian_function">Lorentzian</a>
            function with tilt angle</td>
          <td style="vertical-align: top;"><span style="color: rgb(51,
              102, 255);">2D</span></td>
          <td style="vertical-align: top;">Amplitude Centre_X Center_Y
            HalfWidth_X HalfWidth_Y Angle Background</td>
        </tr>
        <tr>
          <td style="vertical-align: top; font-weight: bold;">plane2d<br>
          </td>
          <td style="vertical-align: top;">Planar function<br>
          </td>
          <td style="vertical-align: top;"><span style="color: rgb(51,
              102, 255);">2D</span></td>
          <td style="vertical-align: top;">Slope_X Slope_Y Background<br>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top; font-weight: bold;">pseudovoigt2d<br>
          </td>
          <td style="vertical-align: top;">Pseudo Voigt with tilt angle
            <img alt="voigt" title="voigt"
src="https://upload.wikimedia.org/wikipedia/commons/8/8f/Voigt_distributionPDF.png"
              align="middle" height="75" width="100"></td>
          <td style="vertical-align: top;"><span style="color: rgb(51,
              102, 255);">2D</span></td>
          <td style="vertical-align: top;">Amplitude Centre_X Center_Y
            HalfWidth_X HalfWidth_Y Angle Background LorentzianRatio<br>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top; font-weight: bold;">quad2d<br>
          </td>
          <td style="vertical-align: top;">Quadratic (parabola) with
            tilt angle</td>
          <td style="vertical-align: top;"><span style="color: rgb(51,
              102, 255);">2D</span></td>
          <td style="vertical-align: top;">Amplitude Centre_X Center_Y
            Curvature_X Curvature_Y Angle Background</td>
        </tr>
        <tr>
          <td valign="top"><b>gaussnd</b><br>
          </td>
          <td valign="top"><a
href="http://en.wikipedia.org/wiki/Gaussian_function#Multi-dimensional_Gaussian_function">n-dimensional






















              Gaussian</a><br>
          </td>
          <td valign="top"><font color="#cc33cc">nD</font><br>
          </td>
          <td valign="top"><br>
          </td>
        </tr>
      </tbody>
    </table>
    <br>
    <div style="text-align: center;"><a href="images/iFit_Models.png"><img
          title="iFit: default functions (in Models)"
          src="images/iFit_Models.png" alt="iFit: default functions (in
          Models)" style="border: 0px solid ; width: 560px; height:
          420px;" align="middle"></a><br>
    </div>
    <span style="font-weight: normal;">To get one of these models, just
      type their function name:<br>
    </span>
    <pre style="margin-left: 40px;"><span style="font-weight: normal;">&gt;&gt; gauss<br>&gt;&gt; a = gauss;<br></span></pre>
    <pre><span style="font-weight: normal;"></span></pre>
    <span style="font-weight: normal;">The </span>list of <span
      style="font-weight: bold;">all available fit functions</span><span
      style="font-weight: normal;"> can be obtained from the command<span
        style="font-weight: bold;">:</span></span><br>
    <pre style="margin-left: 40px;">&gt;&gt; <span style="color: rgb(51, 102, 255);">fits</span>(<span style="font-style: italic;">iData);<br></span></pre>
    which also produces the plot above.<br>
    <h3><a class="mozTocH3" name="mozTocId285330"></a>Specialized models</h3>
    <h4><a class="mozTocH4" name="mozTocId597620"></a>Scattering models
      (neutrons, x-rays)</h4>
    <p>We list below a number of models used to describe neutron and
      x-ray scattering from matter. The structure factor S(q) accounts
      for the structure of matter at the atomistic/molecular level,
      whereas the form factor P(q) accounts for the geometrical
      arrangement of large scale scattering units (micelles, tubes,
      ...). In practice, the scattering from a material can be described
      by:<br>
    </p>
    <p style="text-align: center;"><span style="font-style: italic;">I(q)






















        = P(q).S(q)</span><br>
    </p>
    <p style="text-align: left;">where <span style="font-style:
        italic;">q</span> is the momentum exchange in the material.
      These models have been extracted from the following sources:<br>
    </p>
    <ul>
      <li><a href="http://kur.web.psi.ch/sans1/SANSSoft/sasfit.html">SASfit</a>,
        by <a href="http://kur.web.psi.ch/sans1/SANSSoft/KJ33.html">Joachim






















          Kohlbrecher</a> and <a
          href="mailto:ingo%28at%29cs.tu-berlin.de">Ingo Bressler</a>
        PSI (2006-2011)</li>
      <li>CrysFML by <a href="mailto:jrc@ill.eu">Juan
          Rodriguez-Carvajal</a> and <a href="mailto:jplatas@ull.es">Javier






















          Gonzalez-Platas</a>, ILL and <span class="st">ULL, Tenerife,
          <em>Spain</em></span></li>
    </ul>
    <p style="text-align: left;"></p>
    <table style="text-align: left; width: 1016px; height: 13px;"
      border="1" cellpadding="2" cellspacing="2">
      <tbody>
        <tr>
          <td style="vertical-align: top; font-weight: bold; font-style:
            italic; color: rgb(51, 102, 255); background-color: rgb(255,
            204, 204);">Structure factors<br>
          </td>
          <td style="vertical-align: top; background-color: rgb(255,
            204, 204);"><span style="font-style: italic; font-weight:
              bold; color: rgb(51, 102, 255);">Description</span><br>
          </td>
          <td style="vertical-align: top; font-weight: bold; font-style:
            italic; color: rgb(51, 102, 255); background-color: rgb(255,
            204, 204);">Dimensionality<br>
          </td>
          <td style="vertical-align: top; font-weight: bold; font-style:
            italic; color: rgb(51, 102, 255); background-color: rgb(255,
            204, 204);">Parameters<br>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top; font-weight: bold;">sf_hard_spheres<br>
          </td>
          <td style="vertical-align: top;">Hard Sphere structure factor
            [Percus-Yevick] <img alt="py" title="py"
src="http://www.ee.washington.edu/research/laceo/emwave/discrete/pair2.gif"
              align="middle" height="81" width="100"><br>
          </td>
          <td style="vertical-align: top; color: rgb(51, 204, 0);">1D </td>
          <td style="vertical-align: top;">R rho<br>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top; font-weight: bold;">sf_square_well






















            <br>
          </td>
          <td style="vertical-align: top;">structure factor of particles
            interacting with a square well potential [Sharma]<br>
          </td>
          <td style="vertical-align: top; color: rgb(51, 204, 0);">1D<br>
          </td>
          <td style="vertical-align: top;">R rho epsilon Delta T<br>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top; font-weight: bold;">sf_sticky_hard_spheres<br>
          </td>
          <td style="vertical-align: top;">Sticky Hard Sphere structure
            factor [Baxter/Menon]<br>
          </td>
          <td style="vertical-align: top; color: rgb(51, 204, 0);">1D<br>
          </td>
          <td style="vertical-align: top;">R rho tau<br>
          </td>
        </tr>
      </tbody>
    </table>
    <br>
    <table style="text-align: left; width: 1016px; height: 59px;"
      border="1" cellpadding="2" cellspacing="2">
      <tbody>
        <tr>
          <td style="vertical-align: top; font-weight: bold; font-style:
            italic; color: rgb(51, 102, 255); background-color: rgb(255,
            204, 204);">Form factors: small angle<br>
          </td>
          <td style="vertical-align: top; background-color: rgb(255,
            204, 204);"><span style="font-style: italic; font-weight:
              bold; color: rgb(51, 102, 255);">Description</span><br>
          </td>
          <td style="vertical-align: top; font-weight: bold; font-style:
            italic; color: rgb(51, 102, 255); background-color: rgb(255,
            204, 204);">Dimensionality<br>
          </td>
          <td style="vertical-align: top; font-weight: bold; font-style:
            italic; color: rgb(51, 102, 255); background-color: rgb(255,
            204, 204);">Parameters<br>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top; font-weight: bold;">ff_core_shell<br>
          </td>
          <td style="vertical-align: top;">Spherical/core shell form
            factor [Guinier]<br>
          </td>
          <td style="vertical-align: top; color: rgb(51, 204, 0);">1D<br>
          </td>
          <td style="vertical-align: top;">R1 R2 eta1 eta2<br>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top; font-weight: bold;">ff_sphere&nbsp;






















            <br>
          </td>
          <td style="vertical-align: top;">Sphere form factor [Guinier]<br>
          </td>
          <td style="vertical-align: top; color: rgb(51, 204, 0);">1D<br>
          </td>
          <td style="vertical-align: top;">R eta<br>
          </td>
        </tr>
      </tbody>
    </table>
    <pre style="margin-left: 40px;"><span style="font-style: italic;"></span><span style="font-style: italic;"></span></pre>
    <h4><a class="mozTocH4" name="mozTocId344379"></a> Powder structure
      refinement (Rietveld)</h4>
    <table style="text-align: left; width: 1016px; height: 59px;"
      border="1" cellpadding="2" cellspacing="2">
      <tbody>
        <tr>
          <td style="vertical-align: top; font-weight: bold; font-style:
            italic; color: rgb(51, 102, 255); background-color: rgb(255,
            204, 204);">Powder diffraction<br>
          </td>
          <td style="vertical-align: top; background-color: rgb(255,
            204, 204);"><span style="font-style: italic; font-weight:
              bold; color: rgb(51, 102, 255);">Description</span><br>
          </td>
          <td style="vertical-align: top; font-weight: bold; font-style:
            italic; color: rgb(51, 102, 255); background-color: rgb(255,
            204, 204);">Dimensionality<br>
          </td>
          <td style="vertical-align: top; font-weight: bold; font-style:
            italic; color: rgb(51, 102, 255); background-color: rgb(255,
            204, 204);">Parameters<br>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top; font-weight: bold;">rietveld<br>
          </td>
          <td style="vertical-align: top;"><a
              href="http://en.wikipedia.org/wiki/Rietveld_refinement">Rietveld</a>
            refinement of powder sample <br>
            with full McStas instrument model <img alt="rietveld"
              title="rietveld"
src="http://d32ogoqmya1dw8.cloudfront.net/images/research_education/geochemsheets/techniques/xrayplot-usgs2.gif"
              align="middle" height="59" width="100"><br>
          </td>
          <td style="vertical-align: top; color: rgb(51, 204, 0);">1D,
            2D, 3D<br>
          </td>
          <td style="vertical-align: top;">sample structure, <br>
            instrument parameters<br>
          </td>
        </tr>
      </tbody>
    </table>
    <pre style="margin-left: 40px;"><span style="font-style: italic;"></span><span style="font-style: italic;"></span></pre>
    The '<b>rietveld</b>' model allows to prepare a sample+instrument
    model in order to fit a diffraction/structure data set.<br>
    <br>
    The syntax to build the model, and then perform the refinement is:<br>
    <div style="margin-left: 40px;">
      <pre>&gt;&gt; model=<span style="color: rgb(51, 102, 255);">rietveld</span>(structure, ...., instrument, ....)<br>&gt;&gt; p = <span style="color: rgb(51, 102, 255);">fits</span>(model, measurement);<br></pre>
    </div>
    where the 'structure' describes the initial sample structure (space
    group, cell parameters abc &#945;&#946;&#947;, atom positions, ...); it can be
    given as a CIF, FullProf or ShellX file, as well as from a <span
      style="font-style: italic;">struct</span> type variable with
    fields<span style="font-style: italic;"> 'Spgr' </span>and <span
      style="font-style: italic;">'cell'</span>, followed with atoms
    (giving xyz Biso occupancy spin charge, where only xyz are
    mandatory, others are optional):<br>
    <div style="margin-left: 40px;">
      <pre>Sample.cell&nbsp; = [10.242696&nbsp; 10.242696&nbsp; 10.242696&nbsp; 90.000&nbsp; 90.000&nbsp; 90.000];
Sample.Spgr&nbsp; = 'I 21 3';
Sample.Ca1&nbsp;&nbsp; = [0.46737&nbsp; 0.00000&nbsp; 0.25000&nbsp; 0.60046&nbsp; 0.50000&nbsp;&nbsp; 0.0&nbsp;&nbsp; 2.0];<br>...<br></pre>
    </div>
    the instrument is the name of the McStas instrument description (<span
      style="font-style: italic;">templateDIFF.instr</span> is the
    default). The McStas simulation can be controlled using the default
    McStas options, as described in the <a href="McStas.html">dedicated
      help page</a> : <span style="font-weight: bold;">dir, ncount,
      mpi, seed, gravitation, compile, monitors</span>. The monitors
    options is particularly recommended to specify which monitor file to
    use from the virtual experiment. The resulting model data set should
    be of the same type as the diffractometer measured data set (e.g.
    TOF-angle, height-angle, ...), but not necessarily with same binning
    and axes range.<br>
    <br>
    Any other '<span style="font-style: italic;">name=value</span>'
    argument is assumed to be an instrument parameter. Any scalar
    parameter is made into a model parameter, whereas string/char
    parameters are set as fixed instrument parameters. By default, the
    sample structure (powder/single crystal) is made available to the
    McStas instrument by mean of a <span style="font-style: italic;">'reflections.laz'</span>
    file which should be used by a <span style="font-style: italic;">PowderN</span>
    or <span style="font-style: italic;">Isotropic_Sqw</span>
    component. This name can be changed by specifying the
    'CFML_write=filename' option.<br>
    <br>
    An example of Rietveld model is obtained from a CFL file, and the
    templateDIFF instrument including <span style="font-style: italic;">PowderN(reflections=Powder,...)</span>.
    We thus specify the fixed instrument parameter <span
      style="font-style: italic;">Powder='reflections.laz'</span>. The
    wavelength is kept fixed at 2.36, and we use monitor names matching
    <span style="font-style: italic;">BananaTheta</span>.<br>
    <pre style="margin-left: 40px;">&gt;&gt; model = <span style="color: rgb(51, 102, 255);">rietveld</span>([ <span style="color: rgb(51, 102, 255);">ifitpath</span> <span style="color: rgb(204, 51, 204);">'Data/Na2Ca3Al2F14.cfl'</span> ], <span style="color: rgb(204, 51, 204);">'templateDIFF.instr'</span>, <span style="color: rgb(204, 51, 204);">'Powder=reflections.laz; lambda="2.36"; monitors=BananaTheta'</span>);</pre>
    Once built, it is possible to set constraints on the model with the
    syntax such as (see <a href="iFunc.html#mozTocId579374">iFunc</a>
    page) :<br>
    <pre style="margin-left: 40px;">&gt;&gt; model.parameter=<span style="color: rgb(204, 51, 204);">'fix'</span>     <span style="font-style: italic;">% to lock its value during a fit process</span><br>&gt;&gt; model.parameter='<span style="color: rgb(204, 51, 204);">clear'</span>   <span style="font-style: italic;">% to unlock value during a fit process</span>
&gt;&gt; model.parameter=[min max] <span style="font-style: italic;">% to bound value</span><br>&gt;&gt; model.parameter=[nan nan] <span style="font-style: italic;">% to remove bound constraint</span><br>&gt;&gt; model.parameter=<span style="color: rgb(204, 51, 204);">''</span>        <span style="font-style: italic;">% to remove all constraints on 'parameter'</span><br>&gt;&gt; model.Constraint=<span style="color: rgb(204, 51, 204);">''</span>       <span style="font-style: italic;">% to remove all constraints</span></pre>
    Then we import a data set<br>
    <pre style="margin-left: 40px;">&gt;&gt; measurement = iData([ <span style="color: rgb(51, 102, 255);">ifitpath</span> <span style="color: rgb(204, 51, 204);">'Data/nac_1645179.dat'</span> ]);</pre>
    The refinement is then obtained by starting :<br>
    <pre style="margin-left: 40px;">&gt;&gt; parameters = <span style="color: rgb(51, 102, 255);">fits</span>(model, measurement)</pre>
    with optional arguments as described in the <a href="Fit.html">Fit</a>
    page (the 'constraints' argument of <span style="font-style:
      italic;">fits</span> is partly redundant with the model
    constraints seen above).<br>
    Remember to bound most or all of the model parameters for a faster
    and more reliable convergence of the optimization.<br>
    <h4><a class="mozTocH4" name="mozTocId677670"></a>Phonon/spin-wave
      dispersion</h4>
    <p>The <b>sqw_sine3d</b> model provides a simple way to model most
      <a href="https://en.wikipedia.org/wiki/Phonon">phonon-type</a>
      dispersions, including <a
        href="https://en.wikipedia.org/wiki/Spin_wave">spin-waves</a>,
      acoustic and optical modes, incommensurate dispersions.<br>
    </p>
    <p><u>Limitation</u>: this model only handles simple sine
      dispersions, and can not treat mode exchange (interferences). </p>
    <table style="text-align: left; width: 1016px; height: 59px;"
      border="1" cellpadding="2" cellspacing="2">
      <tbody>
        <tr>
          <td style="vertical-align: top; font-weight: bold; font-style:
            italic; color: rgb(51, 102, 255); background-color: rgb(255,
            204, 204);">S(q,w)<br>
          </td>
          <td style="vertical-align: top; background-color: rgb(255,
            204, 204);"><span style="font-style: italic; font-weight:
              bold; color: rgb(51, 102, 255);">Description</span><br>
          </td>
          <td style="vertical-align: top; font-weight: bold; font-style:
            italic; color: rgb(51, 102, 255); background-color: rgb(255,
            204, 204);">Dimensionality<br>
          </td>
          <td style="vertical-align: top; font-weight: bold; font-style:
            italic; color: rgb(51, 102, 255); background-color: rgb(255,
            204, 204);">Parameters<br>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top; font-weight: bold;"><b>sqw_sine3d</b>
          </td>
          <td style="vertical-align: top;">Phonon dispersions as sine
            wave in HKL (3D) with a damped harmonic oscillator energy
            dispersion <img alt="sqw_sine3d" title="sqw_sine3d"
              src="images/Models_sqw_sine3d.png" align="middle"
              border="0" height="73" width="100"> </td>
          <td style="vertical-align: top; color: rgb(51, 204, 0);">4D
            (HKLw)<br>
          </td>
          <td style="vertical-align: top;">zone center, energy gaps,
            periodicity<br>
          </td>
        </tr>
      </tbody>
    </table>
    <pre style="margin-left: 40px;"><span style="font-style: italic;"></span><span style="font-style: italic;"></span></pre>
    <p>Each dispersion is a sine wave which goes continuously from
      energy E0 to E1, along 3 principal lattice directions (HKL). The
      dispersion has an energy width (DHO). Schematically, the
      dispersion relation is:<br>
    </p>
    <p>&nbsp;&nbsp;&nbsp; <i>w(Q) = E0 + (E1-E0)*sin(Q_freq*pi*(Q-Q0));</i>
      &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; along principal axes<br>
    </p>
    <p>where the wave-vector/momentum Q is expressed in reciprocal
      lattice units [r.l.u]. The parameters of this model allow extended
      flexibility in the description of the mode. Along the 3D HKL
      volume, a dispersion is described with 10 parameters.<br>
      The <i>Q_freq</i> parameter indicates how many dispersion sine
      'arches' there are per reciprocal lattice unit [rlu]. A <i>Q_freq</i>
      of 1/2 means the dispersion extends from e.g. Q=0 to Q=2 rlu. A <i>Q_freq</i>
      of 1 means it extends from Q=0 to Q=1 rlu, and a <i>Q_freq</i> of
      2 means there are two arches between Q=0 and Q=1 rlu (all these
      with Q0=0). A Q_freq of 0 sets a flat dispersion.<br>
    </p>
    <p>To create the model without defined parameter values, you may
      use:<br>
    </p>
    <blockquote>
      <p>sw = <font color="#3366ff">sqw_sine3d</font>;<br>
      </p>
    </blockquote>
    or alternatively, to define starting parameters:<br>
    <blockquote>sw = <font color="#3366ff">sqw_sine3d</font>(<i>p</i>);<br>
    </blockquote>
    where <i>p</i>=[...] is a vector containing the parameter values.
    It may be given as 1,2,3 and 14 value vector, as detailed below.<br>
    <p>A <b>spin-wave </b>could for instance mostly use Q0=0,
      Q_freq=1,&nbsp; E0=0, E1&gt;0 (2 arches from Q=0 to 1 rlu). In a
      simple anti-ferromagnet, the gap width is <i>E1-E0=4J.S</i> with
      J=exchange energy and S=magnetic moment of spins.<br>
    </p>
    <pre>  &gt;&gt; sw = <font color="#3366ff">sqw_sine3d</font>([ E0 E1 Q_freq ])	<i>% creates a dispersion from E0 to E1 with given Q frequency, e.g. .5, 1 or 2</i></pre>
    <p></p>
    <p>A <b>phonon acoustic branc</b>h could use Q0=0, Q_freq=.5, E0=0
      (1 arch from Q=0 to 1 rlu).<br>
    </p>
    <pre>  &gt;&gt; acoustic = <font color="#3366ff">sqw_sine3d</font>(Emax)	<i>% creates an acoustic dispersion up to Emax </i><br></pre>
    <p>An <b>phonon optical branch</b> could use Q0=0, Q_freq=.2,
      E0&gt;E1 E1&gt;0 (1 arch from Q=0 to 1 rlu with Q=0 energy - Raman
      frequency). </p>
    <pre>  &gt;&gt; optical = <font color="#3366ff">sqw_sine3d</font>([ E0 E1 ])	<i>% creates an optical dispersion from E0 to E1</i></pre>
    <p></p>
    <p>The model parameters allow to tune the dispersion:<br>
    </p>
    <ul>
      <li>To shift the minimum/maximum Q of the dispersion, move <i>QH0,QK0,QL0</i>
        parameters.</li>
      <li> To change the extent of the dispersion in Q, vary <i>QH_freq,QK_freq,QL_freq</i>
        parameters.</li>
      <li> To change to minimum and maximum energy, move <i>E0</i> and
        <i>E1_qh,E1_qk,E1_ql</i> parameters. </li>
      <li> To model an incommensurate dispersion, move both <i>QH0,QK0,QL0</i>
        and the <i>QH_freq,QL_freq,QK_freq </i>parameters to
        incommensurate (non rational) values.</li>
      <li>An anisotropic model can be obtained by having different <i>E1
















        </i> and <i>Q_freq</i> parameters along axes.</li>
      <li>A 1D or 2D dispersion can be obtained when setting the
        frequencies (e.g. <i>QK_freq QL_freq</i>) to 0<br>
      </li>
    </ul>
    <p></p>
    <p>The model parameters are:</p>
    <blockquote>
      <p>&nbsp; p(&nbsp;
        1)=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;













        <b>E1_qh</b> energy at QH half period [meV]<br>
        &nbsp; p(&nbsp;
        2)=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;













        <b>E1_qk</b> energy at QK half period [meV]<br>
        &nbsp; p(&nbsp;
        3)=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;













        <b>E1_ql</b> energy at QL half period [meV]<br>
        &nbsp; p(&nbsp;
        4)=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;













        <b>E0</b> zone-centre energy gap [meV]<br>
        &nbsp; p(&nbsp;
        5)=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;













        <b>QH0</b> QH zone-centre [rlu]<br>
        &nbsp; p(&nbsp;
        6)=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;













        <b>QK0</b> QK zone-centre [rlu]<br>
        &nbsp; p(&nbsp;
        7)=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;













        <b>QL0</b> QL zone-centre [rlu]<br>
        &nbsp; p(&nbsp;
        8)=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;













        <b>QH_freq</b> QH frequency [multiples of pi]<br>
        &nbsp; p(&nbsp;
        9)=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;













        <b>QK_freq</b> QK frequency [multiples of pi]<br>
        &nbsp; p(
        10)=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;













        <b>QL_freq</b> QL frequency [multiples of pi]<br>
        &nbsp; p(
        11)=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;













        <b>Gamma</b> Damped Harmonic Oscillator width in energy [meV]<br>
        &nbsp; p( 12)=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>Temperature</b>
        [K]<br>
        &nbsp; p(
        13)=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        <b>Amplitude</b><br>
        &nbsp; p(
        14)=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>Background</b><br>
      </p>
    </blockquote>
    <p>The axes needed for the evaluation are expressed in rlu for
      QH,QK,QL and in meV for the energy.</p>
    <p>A usage example is as follows:<a
        href="images/Models_sqw_sine3d.png"><img alt="sqw_sine3d"
          title="sqw_sine3d" src="images/Models_sqw_sine3d.png"
          align="right" border="0" height="146" width="200"></a><br>
    </p>
    <pre style="margin-left: 40px;">&gt;&gt; ac=<font color="#3366ff">sqw_sine3d</font>(5); 		<i>% an acoustic branch up to 5 meV</i><br>&gt;&gt; qh=<font color="#3366ff">linspace</font>(0,1,50);qk=qh; ql=qh'; w=<font color="#3366ff">linspace</font>(0.01,10,50);	<i>% the axes for evaluation</i><br>&gt;&gt; f=<font color="#3366ff">iData</font>(s,[],qh,qk,ql,w);	<i>% evaluate the model onto given axes</i><br>&gt;&gt; <font color="#3366ff">plot3</font>(log(f(:,:,1,:))); 	<i>% plot as volume</i> in [QH,QK,w, QL=0]. You can also use surf and scatter3 for other rendering<br></pre>
    <p>The axes are given as vectors, but the second is made
      non-parallel to the others, to indicate we wish to build a volume
      out of this. Without transposing the vector, as all axes are the
      same length, they would be interpreted as event data, and the
      resulting evaluation would only contain 50 values.<br>
    </p>
    <p>It is possible to stack as many modes as possible, in different
      flavors. In this case it is advisable to link e.g. the <i>Temperature</i>
      and <i>Background</i> parameters:<a
        href="images/Models_sqw_sine3d_add.png"><img
          alt="sqw_sine3d_3disp" title="sqw_sine3d_3disp"
          src="images/Models_sqw_sine3d_add.png" align="right"
          border="0" height="143" width="200"></a><br>
    </p>
    <pre style="margin-left: 40px;">&gt;&gt; acoustic = <font color="#3366ff">sqw_sine3d</font>(5); optical = <font color="#3366ff">sqw_sine3d</font>([ 10 8 ]); sw = <font color="#3366ff">sqw_sine3d</font>([ 2 4 1 ]);<br>&gt;&gt; disp3 = acoustic + optical + sw;<br>&gt;&gt; disp3.Temperature_2 = <font color="#cc33cc">'"Temperature"'</font>;		% Temperature_2 = Temperature (1st sin3d)<br>&gt;&gt; disp3.Temperature_3 = <font color="#cc33cc">'"Temperature"'</font>;		% Temperature_3 = Temperature<br>&gt;&gt; disp3.Name=<font color="#cc33cc">'sqw_sine3d: acousitc+optical+sw'</font>;<br>&gt;&gt; <font color="#3366ff">mlock</font>(disp3, {<font color="#cc33cc">'Background_2','Background_3'</font>});	% keep them as 0 (default)<br>&gt;&gt; qh=<font color="#3366ff">linspace</font>(0,1,50);qk=qh; ql=qh; w=<font color="#3366ff">linspace</font>(0.01,10,51);	<i>% the axes for evaluation<br></i>&gt;&gt; f=<font color="#3366ff">iData</font>(disp3,[],qh,qk,ql,w);	<i>		% evaluate using initial model parameters</i><br>&gt;&gt; <font color="#3366ff">plot3</font>(log(f(:,:,1,:))); 				<i>% plot as volume</i> in [QH,QK,w, QL=0].<br></pre>
    <p>The <b>plot (surf), plot3, scatter3</b>, and <b>slice</b>
      methods for plotting all provide nice looking rendering of volume
      data. See <a href="Plot.html#mozTocId734523">Plot/3D</a> page.<br>
    </p>
    <h4><a class="mozTocH4" name="mozTocId226848"></a>Phonon dispersion
      in perovskites</h4>
    <p>The <b>sqw_vaks </b>model computes the dispersion of the 5
      lowest <a href="https://en.wikipedia.org/wiki/Phonon">phonon</a>
      dispersions in perovskite cubic crystals. It is based on the Vaks
      parametrization (see references below). The TA1,TA2,LA,TO1 and TO2
      dispersions are obtained from 8 parameters, and a DHO line shape
      is added. The dispersions are anisotropic, with 'valley' and soft
      mode. <br>
      The dynamical matrix is 5x5 and its eigenvalues are the mode
      frequencies.<br>
    </p>
    <p><u>Limitation</u>: even though this is model uses few parameters,
      the dynamic range is limited to e.g.<b> |q|</b> &lt; 0.3-0.5 rlu
      and |w| &lt; 100 meV.<br>
    </p>
    <table style="text-align: left; width: 1016px; height: 59px;"
      border="1" cellpadding="2" cellspacing="2">
      <tbody>
        <tr>
          <td style="vertical-align: top; font-weight: bold; font-style:
            italic; color: rgb(51, 102, 255); background-color: rgb(255,
            204, 204);">S(q,w)<br>
          </td>
          <td style="vertical-align: top; background-color: rgb(255,
            204, 204);"><span style="font-style: italic; font-weight:
              bold; color: rgb(51, 102, 255);">Description</span><br>
          </td>
          <td style="vertical-align: top; font-weight: bold; font-style:
            italic; color: rgb(51, 102, 255); background-color: rgb(255,
            204, 204);">Dimensionality<br>
          </td>
          <td style="vertical-align: top; font-weight: bold; font-style:
            italic; color: rgb(51, 102, 255); background-color: rgb(255,
            204, 204);">Parameters<br>
          </td>
        </tr>
        <tr>
          <td valign="top"><b>sqw_vaks</b></td>
          <td valign="top">Phonon dispersions in perovskite cubic
            crystals using the Vaks parameterisation <a
              href="images/Models_sqw_vaks.png"><img alt="sqw_vaks"
                title="sqw_vaks" src="images/Models_sqw_vaks.png"
                align="middle" border="0" height="75" width="100"></a> </td>
          <td valign="top"><font color="#33cc00">4D (HKLw)<br>
            </font></td>
          <td valign="top">acoustic and optical , coupling parameters,
            soft mode frequency<br>
          </td>
        </tr>
      </tbody>
    </table>
    <br>
    <p>To create the model without defined parameter values, you may
      use:<br>
    </p>
    <blockquote>
      <p>s = <font color="#3366ff">sqw_vaks</font>;<br>
      </p>
    </blockquote>
    or alternatively, to define starting parameters:<br>
    <blockquote>s = <font color="#3366ff">sqw_vaks</font>(<i>p</i>);<br>
    </blockquote>
    where <i>p</i>=[...] is a vector containing the parameter values.
    It may be given as a 12 value vector or a string, as detailed below.<br>
    <br>
    The model parameters are the following:<br>
    <blockquote>&nbsp; p(&nbsp;
      1)=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;













      <b>At</b> transverse acoustic [meV2/rlu2]<br>
      &nbsp; p(&nbsp;
      2)=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;













      <b>Al</b> longitudinal acoustic [meV2/rlu2]<br>
      &nbsp; p(&nbsp;
      3)=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;













      <b>Aa</b> anisotropic acoustic [meV2/rlu2]<br>
      &nbsp; p(&nbsp;
      4)=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;













      <b>St</b> soft mode&nbsp; transverse soft optical [meV2/rlu2]<br>
      &nbsp; p(&nbsp;
      5)=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;













      <b>Sa</b> soft mode&nbsp; anisotropic soft optical [meV2/rlu2]<br>
      &nbsp; p(&nbsp;
      6)=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;













      <b>Vt</b> transverse acoustic-optical coupling [meV2/rlu2]<br>
      &nbsp; p(&nbsp;
      7)=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;













      <b>Va</b> entered as: anisotropic acoustic-optical coupling
      [meV2/rlu2]<br>
      &nbsp; p(&nbsp;
      8)=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;













      <b>w0</b> soft mode frequency at q=0, depends on temperature [meV]<br>
      &nbsp; p(&nbsp;
      9)=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;













      <b>Gamma</b> Damped Harmonic Oscillator width in energy [meV]<br>
      &nbsp; p( 10)=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>Temperature</b>
      [K]<br>
      &nbsp; p(
      11)=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>Amplitude</b><br>
      &nbsp; p(
      12)=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>Background</b><br>
    </blockquote>
    The axes needed for the evaluation are expressed in rlu for QH,QK,QL
    and in meV for the energy.<br>
    <br>
    The <b>plot (surf), plot3, scatter3</b>, and <b>slice</b> methods
    for plotting all provide nice looking rendering of volume data. See
    <a href="file:///home/farhi/dev/iFit/Docs/Plot.html#mozTocId734523">Plot/3D</a>
    page.<br>
    <br>
    There are predefined parameter settings for <font color="#cc33cc">'KTaO3'</font>,
    <font color="#cc33cc">'SrTiO3'</font> and <font color="#cc33cc">'BaTiO3'</font>
    crystals.<br>
    A usage example is:<a href="images/Models_sqw_vaks.png"><img
        alt="sqw_vaks" title="sqw_vaks" src="images/Models_sqw_vaks.png"
        align="right" border="0" height="151" width="200"></a><br>
    <pre>	&gt;&gt; s=<font color="#3366ff">sqw_vaks</font>(<font color="#cc33cc">'KTaO3'</font>); 		<i>% create model, with KTaO3 parameters</i><br>	&gt;&gt; qh=<font color="#3366ff">linspace</font>(0,.5,50);qk=qh; ql=qh; w=<font color="#3366ff">linspace</font>(0.01,10,51);<br> 	&gt;&gt; f=<font color="#3366ff">iData</font>(s,[],qh,qk,ql,w); 		<i>% evaluate model into an iData</i><br>	&gt;&gt; <font color="#3366ff">scatter3</font>(log(f(:,:,1,:)),'filled');	<i>% plot</i> ql(1)=0 plane<br></pre>
    <br>
    <b>References:</b><br>
    <ul>
      <li>E. Farhi et al, <i>EPJB</i>, <b>15</b> (2000) pp 615-623. <a
href="https://www.google.fr/url?sa=t&amp;rct=j&amp;q=&amp;esrc=s&amp;source=web&amp;cd=1&amp;cad=rja&amp;uact=8&amp;ved=0CCIQFjAAahUKEwjVzfP69InHAhVFuBQKHRw2Da4&amp;url=http%3A%2F%2Fepjb.epj.org%2Farticles%2Fepjb%2Fabs%2F2000%2F12%2Fcontents%2Fcontents.html&amp;ei=08u9VZWYAsXwUpzstPAK&amp;usg=AFQjCNEU5zWW66fSudDTwYfsP7OHMvJ2lA&amp;sig2=ufCosM5KrOKdfetSTwa10Q&amp;bvm=bv.99261572,d.d24">DOI:














          10.1007/s100510051164</a> </li>
      <li> A.K. Tagantsev et al, <i>Nature Comm</i>, <b>4</b> (2013)
        2229. <a
href="http://www.nature.com/ncomms/2013/130729/ncomms3229/abs/ncomms3229.html">DOI:














          10.1038/ncomms3229</a></li>
      <li> V.G. Vaks,<i> Introduction to the Microscopic Theory of
          Ferroelectrics</i> (Nauka, Moscow, 1973)</li>
    </ul>
    <h4><a class="mozTocH4" name="mozTocId885605"></a>Acoustic phonon
      dispersion in mono-atomic cubic crystal</h4>
    The <b>sqw_cubic_monoatomic</b> model provides 3 acoustic <a
      href="https://en.wikipedia.org/wiki/Phonon">phonon</a> dispersions
    from a dynamical matrix computation. It uses only 2 parameters for
    these 3 modes, plus additional DHO parameters. Each dispersion is
    basically:<br>
    <blockquote><i>w(k) = Emax*sin(k.a) </i><i>&nbsp;&nbsp;&nbsp;
        &nbsp;&nbsp;&nbsp; </i>along principal axes.<br>
    </blockquote>
    The dynamical matrix is 3x3 with sine and cosine terms. Eigenvalues
    provide the mode energies.<br>
    <br>
    <table style="text-align: left; width: 1016px; height: 59px;"
      border="1" cellpadding="2" cellspacing="2">
      <tbody>
        <tr>
          <td style="vertical-align: top; font-weight: bold; font-style:
            italic; color: rgb(51, 102, 255); background-color: rgb(255,
            204, 204);">S(q,w)<br>
          </td>
          <td style="vertical-align: top; background-color: rgb(255,
            204, 204);"><span style="font-style: italic; font-weight:
              bold; color: rgb(51, 102, 255);">Description</span><br>
          </td>
          <td style="vertical-align: top; font-weight: bold; font-style:
            italic; color: rgb(51, 102, 255); background-color: rgb(255,
            204, 204);">Dimensionality<br>
          </td>
          <td style="vertical-align: top; font-weight: bold; font-style:
            italic; color: rgb(51, 102, 255); background-color: rgb(255,
            204, 204);">Parameters<br>
          </td>
        </tr>
        <tr>
          <td valign="top"><b>sqw_</b><b>cubic_monoatomic</b></td>
          <td valign="top">Phonon dispersions in a monoatomic cubic
            crystal using the Dynamical matrix.<a
              href="images/Models_sqw_cubic_mono.png"><img
                alt="sqw_cubic_mono" title="sqw_cubic_mono"
                src="images/Models_sqw_cubic_mono.png" align="middle"
                border="0" height="76" width="100"></a> </td>
          <td valign="top"><font color="#33cc00">4D (HKLw)<br>
            </font></td>
          <td valign="top">acoustic force constant ratio and scaling
            energy<br>
          </td>
        </tr>
      </tbody>
    </table>
    <br>
    The model parameters are the following:<br>
    <blockquote>&nbsp; p(&nbsp;
      1)=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;












      <b>C_ratio</b> C1/C2 force constant ratio first/second neighbours<a
href="file:///home/farhi/dev/iFit/Docs/images/Models_sqw_cubic_mono.png"><img
          alt="sqw_cubic_mono" title="sqw_cubic_mono"
          src="file:///home/farhi/dev/iFit/Docs/images/Models_sqw_cubic_mono.png"
          align="right" border="0" height="152" width="200"></a><br>
      &nbsp; p(&nbsp;
      2)=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;












      <b>E0</b> sqrt(C1/m) energy [meV]<br>
      &nbsp; p(&nbsp;
      3)=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;












      <b>Gamma</b> Dampled Harmonic Oscillator width in energy [meV]<br>
      &nbsp; p(&nbsp;
      4)=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>Temperature</b>
      [K]<br>
      &nbsp; p(&nbsp;
      5)=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>Amplitude</b><br>
      &nbsp; p(&nbsp;
      6)=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>Background</b><br>
    </blockquote>
    The axes needed for the evaluation are expressed in <i>rlu</i> for
    QH,QK,QL and in meV for the energy.<br>
    <br>
    A usage example is:<br>
    <pre>	&gt;&gt; s=<font color="#3366ff">sqw_cubic_monoatomic</font>([ 3 3 ]); 	<i>% create model, with C1/C2=3 E0=3</i><br>	&gt;&gt; qh=<font color="#3366ff">linspace</font>(0,.5,50);qk=qh; ql=qh; w=<font color="#3366ff">linspace</font>(0.01,10,51);<br> 	&gt;&gt; f=<font color="#3366ff">iData</font>(s,[],qh,qk,ql,w); 		<i>% evaluate model into an iData</i><br>	&gt;&gt; <font color="#3366ff">plot3</font>(log(f(:,:,1,:)));	<i>	% plot </i><i>ql(1)=0 plane</i><br></pre>
    The <b>plot (surf), plot3, scatter3</b>, and <b>slice</b> methods
    for plotting all provide nice looking rendering of volume data. See
    <a href="file:///home/farhi/dev/iFit/Docs/Plot.html#mozTocId734523">Plot/3D</a>
    page.<br>
    <br>
    <b>References:</b><br>
    <blockquote>E. Meisterhofer &lt;<a
        href="http://lampx.tugraz.at/%7Ehadley/ss1/phonons/scdos/sc.pdf">http://lampx.tugraz.at/~hadley/ss1/phonons/scdos/sc.pdf</a>&gt;
      2013<br>
    </blockquote>
    <h4><a class="mozTocH4" name="mozTocId881911"></a> Phonon dispersion
      from <i>ab-initio</i> force estimate and dynamical matrix using
      PHON/QuantumEspresso<br>
    </h4>
    The <b>sqw_phon</b> model computes dispersions from a
    diagonalization of the dynamical matrix, using the <a
      href="http://www.homepages.ucl.ac.uk/%7Eucfbdxa/phon/">PHON</a>
    code. This matrix is obtained from a force estimate computed from <a
      href="https://en.wikipedia.org/wiki/Density_functional_theory"><i>ab-initio</i></a><a>
      DFT</a>, using <a href="http://www.quantum-espresso.org/">Quantum
      Espresso</a>.<br>
    <br>
    <table style="text-align: left; width: 1016px; height: 59px;"
      border="1" cellpadding="2" cellspacing="2">
      <tbody>
        <tr>
          <td style="vertical-align: top; font-weight: bold; font-style:
            italic; color: rgb(51, 102, 255); background-color: rgb(255,
            204, 204);">S(q,w)<br>
          </td>
          <td style="vertical-align: top; background-color: rgb(255,
            204, 204);"><span style="font-style: italic; font-weight:
              bold; color: rgb(51, 102, 255);">Description</span><br>
          </td>
          <td style="vertical-align: top; font-weight: bold; font-style:
            italic; color: rgb(51, 102, 255); background-color: rgb(255,
            204, 204);">Dimensionality<br>
          </td>
          <td style="vertical-align: top; font-weight: bold; font-style:
            italic; color: rgb(51, 102, 255); background-color: rgb(255,
            204, 204);">Parameters<br>
          </td>
        </tr>
        <tr>
          <td valign="top"><b>sqw_phon</b><b></b></td>
          <td valign="top">Phonon dispersions from the Dynamical matrix,
            using <a
              href="file:///home/farhi/dev/iFit/Docs/images/Models_sqw_phon.png"><img
                alt="sqw_phon" title="sqw_phon"
                src="file:///home/farhi/dev/iFit/Docs/images/Models_sqw_phon.png"
                align="right" border="0" height="76" width="100"></a>forces





            estimated by <i>ab-initio</i>, using PHON/QE<i>.&nbsp;</i>
          </td>
          <td valign="top"><font color="#33cc00">4D (HKLw)<br>
            </font></td>
          <td valign="top">only the DHO line shape. <i>ab-initio</i>
            implies no tunable parameter.<br>
          </td>
        </tr>
      </tbody>
    </table>
    <br>
    The procedure is entirely automatic, and only requires a VASP-type
    POSCAR file describing the lattice and the atom coordinates therein.
    A supercell is automatically generated, then forces are estimated by
    differentiation of a set of atom displacements. Temporary data files
    are created (POSCAR supercell, FORCES, INPHON, ...).<br>
    <br>
    The general syntax for creating&nbsp; the S(q,w) model is:<br>
    <blockquote>s = <font color="#3366ff">sqw_phon</font>;&nbsp;&nbsp;&nbsp;






      &nbsp;&nbsp;&nbsp; % creates a simple fcc Al model<br>
    </blockquote>
    or<br>
    <blockquote>s = <font color="#3366ff">sqw_phon</font>(POSCAR,
      FORCES);&nbsp;&nbsp;&nbsp; % re-use a previous computation of
      FORCES<br>
    </blockquote>
    or<br>
    <blockquote>s = <font color="#3366ff">sqw_phon</font>(POSCAR,
      options, ...);<br>
    </blockquote>
    or<br>
    <blockquote>s = <font color="#3366ff">sqw_phon</font>(POSCAR,
      pseudopotentials..., options, ...);<br>
    </blockquote>
    where <i>POSCAR</i> is the location of a POSCAR VASP-type file,
    which describes the system geometry (atom types and position in the
    cell). Even though the input geometry file is a POSCAR, VASP by
    itself is <i><b>not</b></i> needed.<br>
    <br>
    The <i>FORCES</i> file is a pre-computed FORCES file (for PHON).
    When specified, no ab-initio computation is performed, and the
    POSCAR file <i>must</i> be the corresponding supercell POSCAR
    geometry. When missing, these are computed using the small
    displacement method.<br>
    <br>
    The <i>pseudopotentials</i><i> </i>are as many
    filenames/directories to pseudo potential files (UPF format)
    suitable for QuantumEspresso. Just add them to the <i>sqw_phon</i>
    arguments. When not given, available potentials will be searched in
    current location, the Home directory, and the standard
    QuantumEspresso locations (PSEUDO_DIR, $HOME/espresso/pseudo). When
    more than one potential is available for an atom type, a list
    selector is displayed to request which one to choose. The PBE-PAW
    potentials are preferred and pre-selected. Pseudo-potential can be
    obtained at <a
      href="http://www.quantum-espresso.org/pseudopotentials/">QuantomEspresso











      PP selector</a>.<br>
    <br>
    Other options, given as strings, or a structure, allow to customise
    how to create the supercell, the displacement vectors, and
    parameters to control the forces estimate using <a
href="http://www.quantum-espresso.org/wp-content/uploads/Doc/INPUT_PW.html">QuantumEspresso/PWSCF</a>.<br>
    <br>
    <u><i> </i></u><u><i>General options:</i></u><br>
    <ul>
      <li><b>target</b>: The <font color="#cc33cc">'target=LOCATION'</font>
        argument can be set to save these files to a defined directory,
        which must pre-exist. Without specification, a temporary
        directory will be used.</li>
      <li><b>disp</b>: The generation of the supercell and the forces
        can be tuned by choosing the <i>initial atom displacement</i>,
        or a random one. Use e.g. <font color="#cc33cc">'disp=[ 1 -1
          1]' </font>or <font color="#cc33cc">'disp=random'</font> or
        <font color="#cc33cc">'random'</font> as argument. </li>
      <li><b>supercell</b>: The <i>dimension of the supercell</i> can
        be given using e.g. the <font color="#cc33cc">'supercell=2'</font>
        (for a 2x2x2 supercell) argument, or <font color="#cc33cc">'supercell=[2






          3 2]'</font>.</li>
      <li><b>mpi</b>: The number of CPU's to use for Quantum Espresso
        can be set with option e.g <font color="#cc33cc">'mpi=4'</font>.
        This option requires e.g. <a href="http://www.open-mpi.org/">OpenMPI</a>
        to be installed, and is only validated on Linux systems (<i>sudo
          apt-get install openmpi-bin</i>).</li>
      <li><b>potential_auto</b>: when set to 1, the best
        pseudo-potential will automatically be chose (e.g. PBE/PAW).<br>
      </li>
    </ul>
    <i><u>Options for QuantumEspresso/PWSCF affecting memory usage:</u></i><br>
    <ul>
      <li><b>diagonalization</b>: <font color="#cc33cc">'david'</font>
        or <font color="#cc33cc">'cg'</font>. The Davidson method is
        faster than the conjugate-gradient but uses more memory.</li>
      <li><b>mixing_ndim</b>: number of iterations used in mixing,
        default=8. If you are tight with memory, you may reduce it to 4.
        A larger value will improve the SCF convergence, and use more
        memory.</li>
    </ul>
    <i><u>Options for QuantumEspresso/PWSCF affecting convergence:<br>
      </u></i>
    <ul>
      <li><b> occupations</b>: For metallic and insulator systems, the <i>electron







          state occupations</i> should be set by using argument <font
          color="#cc33cc">'metal'</font> or <font color="#cc33cc">'insulator'</font>,
        or <font color="#cc33cc">'occupations=smearing'</font> or<font
          color="#cc33cc"> 'occupations=fixed'</font> (as in <a
href="http://www.quantum-espresso.org/wp-content/uploads/Doc/INPUT_PW.html">QuantumEspresso/PWSCF</a>).</li>
      <li><b> ecutwfc</b>: The <i>kinetic energy cutoff</i> can also be
        specified using e.g. argument <font color="#cc33cc">'ecutwfc=30'</font>
        in [Ry]. The default is to use [15*the number of different
        atoms].</li>
      <li><b>ecutrho</b>: kinetic energy cutoff (Ry) for charge density
        and potential. Default=4*ecutwfc, suitable for PAW. Larger value
        improves convergence, especially for ultra-soft PP (you should
        then use 8-12*ecutwfc).</li>
      <li><b> kpoints</b>: The size of the <i>Monkhorst-Pack grid</i>
        can be set using e.g. <font color="#cc33cc">'kpoints=2'</font>
        or <font color="#cc33cc">'kpoints=[3 4 3]'</font>.</li>
      <li><b>mixing_beta</b>: mixing factor for self-consistency,
        default=0.7. use 0.3 to improve convergence.</li>
      <li><b>electron_maxstep</b>: max number of iterations for SCF,
        default=100. Larger value improves convergence.</li>
      <li><b>conv_thr: </b>Convergence threshold for selfconsistency.
        default=1e-6.</li>
    </ul>
    If you have difficulties in the model SCF convergence, you may use
    e.g:<br>
    <pre>  &gt;&gt; s=<font color="#3366ff">sqw_phon</font>(POSCAR,<font color="#cc33cc">'random'</font>,<font color="#cc33cc">'miximg_beta=0.3; electron_maxstep=200; conv_thr=1e-6; occupations=smearing; ecutwfc=50; mixing_ndim=12'</font>);</pre>
    If you are tight on the memory (e.g. the system is large), you may
    try:<br>
    <pre>  &gt;&gt; s=<font color="#3366ff">sqw_phon</font>(POSCAR,<font color="#cc33cc">'random'</font>,<font color="#cc33cc">'ecutwfc=15; mixing_ndim=4; diagonalization=cg'</font>);</pre>
    <br>
    The model parameters, once built, are the following:<br>
    <blockquote>&nbsp; p(&nbsp;
      1)=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>Amplitude</b><br>
      &nbsp; p(&nbsp;
      2)=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;











      <b>Gamma</b>&nbsp; Damped Harmonic Oscillator width in energy
      [meV]<br>
      &nbsp; p(&nbsp;
      3)=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>Background</b><br>
      &nbsp; p(&nbsp;
      4)=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>Temperature</b>&nbsp;











      [K]<br>
    </blockquote>
    The axes needed for the evaluation are expressed in rlu for QH,QK,QL
    and in meV for the energy.<br>
    <br>
    A usage example is:<a href="images/Models_sqw_phon.png"><img
        alt="sqw_phon Al fcc" title="sqw_phon Al fcc"
        src="images/Models_sqw_phon.png" align="right" border="0"
        height="153" width="200"></a><br>
    <pre>	&gt;&gt; s=<font color="#3366ff">sqw_phon</font>([<font color="#cc33cc"> ifitpath 'Data/POSCAR_Al'</font>],<font color="#cc33cc">'metal'</font>,<font color="#cc33cc">'mpi=4;potential_auto=1'</font>); 	<i>% create model from given POSCAR</i><br>	&gt;&gt; qh=<font color="#3366ff">linspace</font>(0,.5,50);qk=qh; ql=qh; w=<font color="#3366ff">linspace</font>(0.01,50,51);<br> 	&gt;&gt; f=<font color="#3366ff">iData</font>(s,[],qh,qk,ql,w); 		<i>% evaluate model into an iData</i><br>	&gt;&gt; <font color="#3366ff">plot3</font>(log(f(:,:,1,:)));	<i>	% plot ql(1)=0 plane</i><br></pre>
    When re-using existing POSCAR ad FORCES files, the model creation is
    immediate (no<i> ab-initio</i> step is done with Quantum Espresso).
    The following model for MgO has been pre-computed with potentials <a
href="http://www.quantum-espresso.org/wp-content/uploads/upf_files/Mg.pbe-nsp-bpaw.UPF">Mg.pbe-nsp-bpaw.UPF</a>
    and <a
href="http://www.quantum-espresso.org/wp-content/uploads/upf_files/O.pbe-kjpaw.UPF">O.pbe-kjpaw.UPF</a>.<br>
    <pre>	&gt;&gt; s=<font color="#3366ff">sqw_phon</font>([<font color="#cc33cc"> ifitpath 'Data/POSCAR_MgO'</font>],[<font color="#cc33cc"> ifitpath 'Data/FORCES_MgO'</font>]); 	<i>% create model from given POSCAR</i> and FORCES<br>	&gt;&gt; qh=<font color="#3366ff">linspace</font>(0,.5,50);qk=qh; ql=qh; w=<font color="#3366ff">linspace</font>(0.01,100,51);<br> 	&gt;&gt; f=<font color="#3366ff">iData</font>(s,[],qh,qk,ql,w); 		<i>% evaluate model into an iData</i><br>	&gt;&gt; <font color="#3366ff">scatter3</font>(log(f(:,:,1,:)),<font color="#cc33cc">'filled'</font>);	<i>% plot ql(1)=0 plane, which then shows acoustic and optical modes.</i></pre>
    <br>
    The <b>plot (surf), plot3, scatter3</b>, and <b>slice</b> methods
    for plotting all provide nice looking rendering of volume data. See
    <a href="file:///home/farhi/dev/iFit/Docs/Plot.html#mozTocId734523">Plot/3D</a>
    page.<br>
    <br>
    <b>References:</b><br>
    <ul>
      <li><a href="http://chianti.geol.ucl.ac.uk/%7Edario">PHON</a>: D.
        Alfe, <i>Computer Physics Communications</i> <b>180</b>,2622-2633











        (2009). &lt;<a href="http://chianti.geol.ucl.ac.uk/%7Edario">http://chianti.geol.ucl.ac.uk/~dario</a>&gt;.











        BSD license.</li>
      <li><a href="http://www.quantum-espresso.org/">Quantum Espresso</a>:
        P. Giannozzi, et al <i>J.Phys.:Condens.Matter,</i> <b>21</b>,
        395502 (2009). &lt;<a href="http://www.quantum-espresso.org/">http://www.quantum-espresso.org/</a>&gt;.











        GPL2 license.</li>
    </ul>
    <b>Requirements/installation:</b><br>
    <ul>
      <li><a href="http://chianti.geol.ucl.ac.uk/%7Edario">PHON</a> must
        be installed. It requires a Fortran 90 compiler, e.g. <b>gfortran</b>
        (<i>sudo apt-get install gfortran</i>). Extract the PHON
        archive, then compile with: <i>./configure; make</i> . Once
        done, copy the <i>PHON/src/phon</i> executable to a system-wide
        location such as /usr/local/bin or /usr/bin. <br>
      </li>
    </ul>
    <blockquote>We provide a <a
href="http://packages.mccode.org/debian/dists/stable/main/binary-amd64/phon-1.40-amd64.deb">PHON






        Debian package</a> at <a href="http://packages.mccode.org/">packages.mccode.org</a>.
      Type (Ubuntu/Mint/Debian):<br>
    </blockquote>
    <ul>
    </ul>
    <blockquote>
      <blockquote>
        <pre>sudo apt-add-repository 'deb http://packages.mccode.org/debian stable main;&nbsp;
sudo apt-get update
sudo apt-get install phon
</pre>
      </blockquote>
    </blockquote>
    <ul>
      <li><a href="http://www.quantum-espresso.org/">Quantum Espresso</a>
        (we use pw.x/pwscf) must be installed. Installers exist for
        Linux and Windows systems. Install it e.g. with <i>sudo apt-get
          install quantum-espresso</i> (Debian class systems) and <i>sudo










          yum install quantum-espresso</i> (RedHat class systems). Type
        (Ubuntu/Mint/Debian):</li>
    </ul>
    <blockquote>
      <blockquote>
        <pre>sudo apt-get install quantum-espresso</pre>
      </blockquote>
    </blockquote>
    <ul>
    </ul>
    <h4><a class="mozTocH4" name="mozTocId990577"></a>Phonon dispersion
      from <i>ab-initio</i> force estimate and dynamical matrix using
      ASE</h4>
    <p>The <b>sqw_ph_ase</b> (i.e. <i>'phase'</i>) model computes
      phonon dispersions using the <a
        href="https://wiki.fysik.dtu.dk/ase/">Atomic Simulation
        Environment</a> (ASE). The only needed input for the model to
      run is the name of a configuration file describing the material
      lattice and atom positions. This file can be in any <a
        href="https://wiki.fysik.dtu.dk/ase/ase/io.html#module-ase.io">ASE





        supported format</a>, e.g. POSCAR, CIF, PDB, ...<br>
    </p>
    <table style="text-align: left; width: 1016px; height: 59px;"
      border="1" cellpadding="2" cellspacing="2">
      <tbody>
        <tr>
          <td style="vertical-align: top; font-weight: bold; font-style:
            italic; color: rgb(51, 102, 255); background-color: rgb(255,
            204, 204);">S(q,w)<br>
          </td>
          <td style="vertical-align: top; background-color: rgb(255,
            204, 204);"><span style="font-style: italic; font-weight:
              bold; color: rgb(51, 102, 255);">Description</span><br>
          </td>
          <td style="vertical-align: top; font-weight: bold; font-style:
            italic; color: rgb(51, 102, 255); background-color: rgb(255,
            204, 204);">Dimensionality<br>
          </td>
          <td style="vertical-align: top; font-weight: bold; font-style:
            italic; color: rgb(51, 102, 255); background-color: rgb(255,
            204, 204);">Parameters<br>
          </td>
        </tr>
        <tr>
          <td valign="top"><b>sqw_ph_ase</b></td>
          <td valign="top">Phonon dispersions from the Dynamical matrix,
            using<a
              href="file:///home/farhi/dev/iFit/Docs/images/Models_sqw_ph_ase.png"><img
src="file:///home/farhi/dev/iFit/Docs/images/Models_sqw_ph_ase.png"
                title="sqw_ph_ase Al fcc" alt="sqw_ph_ase Al fcc"
                align="right" border="0" height="74" width="100"></a>
            forces estimated by <i>ab-initio </i>using ASE.<i>&nbsp;</i>
          </td>
          <td valign="top"><font color="#33cc00">4D (HKLw)<br>
            </font></td>
          <td valign="top">only the DHO line shape. <i>ab-initio</i>
            implies no tunable parameter.<br>
          </td>
        </tr>
      </tbody>
    </table>
    <br>
    The procedure is entirely automatic. A supercell is automatically
    generated, then forces are estimated by differentiation of a set of
    atom displacements. Temporary data files are created (POSCAR
    supercell, FORCES, INPHON, ...).<br>
    <br>
    The general syntax for creating&nbsp; the S(q,w) model is:<br>
    <blockquote>s = <font color="#3366ff">sqw_ph_ase</font>;&nbsp;&nbsp;&nbsp;






      &nbsp;&nbsp;&nbsp; creates a simple fcc Al model<br>
    </blockquote>
    or<br>
    <blockquote>s = <font color="#3366ff">sqw_ph_ase</font>(configuration);<br>
    </blockquote>
    or<br>
    <blockquote>s = <font color="#3366ff">sqw_ph_ase</font>(configuration,





      options, ...);<br>
    </blockquote>
    where <i>configuration</i> is the location of any file format
    supported by ASE, which describes the system geometry (atom types
    and position in the cell).<br>
    <br>
    Other options, given as strings, or a structure, allow to customise
    how to create the supercell and other computational tuning stuff.<br>
    <br>
    <u><i> </i></u><u><i>General options:</i></u><br>
    <ul>
      <li><b>target</b>: The <font color="#cc33cc">'target=LOCATION'</font>
        argument can be set to save these files to a defined directory,
        which must pre-exist. Without specification, a temporary
        directory will be used.</li>
      <li><b>supercell</b>: The <i>dimension of the supercell</i> can
        be given using e.g. the <font color="#cc33cc">'supercell=2'</font>
        (for a 2x2x2 supercell) argument, or <font color="#cc33cc">'supercell=[2






          3 2]'</font>.</li>
    </ul>
    <p>Currently, this model uses the default ASE computational
      calculator '<a
href="https://wiki.fysik.dtu.dk/ase/ase/calculators/emt.html#module-ase.calculators.emt">EMT</a>'.




      This calculator can currently handle H, C, N, O, Al, Ni, Cu, Pd,
      Ag, Pt and Au elements. It is relatively slow. </p>
    <p>The model parameters, once built, are the following:<br>
    </p>
    <blockquote>&nbsp; p(&nbsp;
      1)=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>Amplitude</b><br>
      &nbsp; p(&nbsp;
      2)=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;











      <b>Gamma</b>&nbsp; Damped Harmonic Oscillator width in energy
      [meV]<br>
      &nbsp; p(&nbsp;
      3)=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>Background</b><br>
      &nbsp; p(&nbsp;
      4)=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>Temperature</b>&nbsp;











      [K]<br>
    </blockquote>
    The axes needed for the evaluation are expressed in <i>rlu</i> for
    QH,QK,QL and in meV for the energy.<br>
    <br>
    A usage example is:<a href="images/Models_sqw_ph_ase.png"><img
        alt="sqw_ph_ase Al fcc" title="sqw_ph_ase Al fcc"
        src="images/Models_sqw_ph_ase.png" align="right" border="0"
        height="153" width="200"></a><br>
    <pre>	&gt;&gt; s=<font color="#3366ff">sqw_ph_ase</font>(<font color="#cc33cc">[ ifitpath 'Data/POSCAR_Al'</font>]); 	<i>% create model from given POSCAR</i><br>	&gt;&gt; qh=<font color="#3366ff">linspace</font>(0.01,.5,50);qk=qh; ql=qh; w=<font color="#3366ff">linspace</font>(0.01,50,51);<br> 	&gt;&gt; f=<font color="#3366ff">iData</font>(s,[],qh,qk,ql,w); 		<i>% evaluate model into an iData</i><br>	&gt;&gt; <font color="#3366ff">scatter3</font>(log(f(:,:,1,:)));	<i>	% plot ql(1)=0 plane<br></i></pre>
    To get a system with acoustic and optical modes:<br>
    <pre>	&gt;&gt; s=<font color="#3366ff">sqw_ph_ase</font>(<font color="#cc33cc">[ ifitpath 'Data/POSCAR_AlN'</font>]); 	<i>% create model from given POSCAR</i><br>	&gt;&gt; qh=<font color="#3366ff">linspace</font>(0.01,.5,50);qk=qh; ql=qh; w=<font color="#3366ff">linspace</font>(0.01,50,51);<br> 	&gt;&gt; f=<font color="#3366ff">iData</font>(s,[],qh,qk,ql,w); 		<i>% evaluate model into an iData</i><br>	&gt;&gt; <font color="#3366ff">scatter3</font>(log(f(:,:,1,:)));	<i>	% plot ql(1)=0 plane with acoustic and optical modes</i></pre>
    The <b>plot (surf), plot3, scatter3</b>, and <b>slice</b> methods
    for plotting all provide nice looking rendering of volume data. See
    <a href="file:///home/farhi/dev/iFit/Docs/Plot.html#mozTocId734523">Plot/3D</a>
    page.<br>
    <br>
    <b>References:</b><br>
    <a href="https://wiki.fysik.dtu.dk/ase">Atomic Simulation
      Environment</a><br>
    S. R. Bahn and K. W. Jacobsen, Comput. Sci. Eng., Vol. 4, 56-66,
    2002.<br>
    <br>
    <b>Requirements:</b><br>
    The <a href="https://wiki.fysik.dtu.dk/ase">ASE</a> must be
    installed. Packages exist for Ubuntu/Mint/Debian, RedHat/Fedora,
    OpenSUSE, MacOSX (brew), and Windows (experimental). Type
    (Ubuntu/Mint/Debian):
    <blockquote>
      <blockquote>
        <pre>sudo apt-get install python-ase</pre>
      </blockquote>
    </blockquote>
    <h3><a class="mozTocH3" name="mozTocId810939"></a><span
        style="font-weight: bold;">Model builder: defining a new model
        easy</span></h3>
    The <span style="font-style: italic;">ifitmakefunc</span> tool
    enables to define a new fit function/model from a simple dialog, by
    entering its <a href="images/ifitmakefunc.png"><img
        title="ifitmakefunc" src="images/ifitmakefunc.png"
        alt="ifitmakefunc" style="border: 0px solid ; width: 150px;
        height: 137px;" align="right"></a>expression as a function of
    the parameter vector <span style="font-style: italic; font-weight:
      bold;">p</span> and the axes <span style="font-style: italic;
      font-weight: bold;">x,y,z</span><b>,t,u,v,w</b><br>
    <pre style="margin-left: 40px;">&gt;&gt; <span style="color: rgb(255, 0, 0);">h</span>=<span style="color: rgb(51, 102, 255);">ifitmakefunc;<br><span style="color: rgb(0, 0, 0);">&gt;&gt; h=</span>edit<span style="color: rgb(0, 0, 0);">(iFunc);	<span style="font-style: italic;">% equivalent</span></span><br></span></pre>
    The only required argument is the expression, but you may as
    well&nbsp; enter a function name and description, parameter names
    and default values, as well as a constraint to be evaluated before
    computing the function value. When started without any parameters,
    the Gaussian function settings are used.<br>
    <br>
    The function both creates a function file, and returns its model
    object, that may evaluate and adjust to a data set with <a
      href="Fit.html"><span style="font-weight: bold;">fits</span></a>.<br>
    <pre style="margin-left: 40px;">&gt;&gt; [p,criteria,message,output]= <span style="color: rgb(51, 102, 255);">fits</span>(a, <span style="color: rgb(255, 0, 0);">h</span><span style="color: rgb(204, 51, 204);"></span>);<br>&gt;&gt; [p,criteria,message,output]= <span style="color: rgb(51, 102, 255);">fits</span>(<span style="color: rgb(255, 0, 0);">h</span><span style="color: rgb(204, 51, 204);"></span>, a); <span style="font-style: italic;">% same as above</span><br></pre>
    A quick definition, without using the dialog, can be performed with
    the syntax:<br>
    <pre style="margin-left: 40px;">&gt;&gt; <span style="color: rgb(255, 0, 0);">h</span>=<span style="color: rgb(51, 102, 255);">ifitmakefunc<span style="color: rgb(0, 0, 0);">(<span style="color: rgb(204, 51, 204);">'p(1)*exp( (x-p(2))/p(3) )'</span>);</span></span><br>&gt;&gt; <span style="color: rgb(51, 102, 255);">fits</span>(a,<span style="color: rgb(51, 102, 255);">  iFunc<span style="color: rgb(0, 0, 0);">(<span style="color: rgb(204, 51, 204);">'p(1)*exp( (x-p(2))/p(3) )'</span>));</span></span> <span style="font-style: italic;">% same as above</span><br></pre>
    where&nbsp; <span style="font-weight: bold; font-style: italic;">p</span>
    is the vector that holds parameters. Axes are<span
      style="font-weight: bold; font-style: italic;"> x </span><span
      style="font-style: italic;">(rows)</span><span style="font-weight:
      bold; font-style: italic;">,y </span><span style="font-style:
      italic;">(columns)</span><span style="font-weight: bold;
      font-style: italic;">,z </span><span style="font-style: italic;">(pages)</span><span
      style="font-weight: bold; font-style: italic;">,t</span><span
      style="font-style: italic;"> (time)</span>. Beware to use a model
    expression with element-wise division and multiplication operators (<span
      style="font-weight: bold;">./</span> and <span
      style="font-weight: bold;">.*</span>). The function builder is
    known to work well for 1D and 2D functions.<br>
    <br>
    You can also build complex models from simpler ones using <a
      href="iFunc.html">iFunc</a> methods/operators, such as in<br>
    <pre style="margin-left: 40px;">&gt;&gt; h = gauss + lorz<br>&gt;&gt; h = convn(lorz, 3)<br>&gt;&gt; h = convn(gauss, lorz)<br>&gt;&gt; h = gauss .* lorz; % a 1D model<br>&gt;&gt; h = gauss  * lorz; % a 2D model
<br></pre>
    The full syntax for the model builder is:<br>
    <pre style="margin-left: 40px;">&gt;&gt; <span style="color: rgb(255, 0, 0);">h</span>=<span style="color: rgb(51, 102, 255);">ifitmakefunc</span><span style="color: rgb(51, 102, 255);"><span style="color: rgb(0, 0, 0);">(</span></span><span style="color: rgb(51, 102, 255);"><span style="color: rgb(0, 0, 0);"><span style="color: rgb(204, 51, 204);">'expression'<span style="color: rgb(0, 0, 0);">);<br></span></span></span></span>&gt;&gt; <span style="color: rgb(255, 0, 0);">h</span>=<span style="color: rgb(51, 102, 255);">ifitmakefunc</span><span style="color: rgb(51, 102, 255);"><span style="color: rgb(0, 0, 0);">(</span></span><span style="color: rgb(51, 102, 255);"><span style="color: rgb(0, 0, 0);"><span style="color: rgb(204, 51, 204);"><span style="font-style: italic;">iFunc model</span><span style="color: rgb(0, 0, 0);">);</span></span></span></span>	<span style="font-style: italic;"><br>&gt;&gt; </span><span style="color: rgb(255, 0, 0);">h</span>=<span style="color: rgb(51, 102, 255);">edit</span><span style="font-style: italic;">(</span><span style="color: rgb(51, 102, 255);"><span style="color: rgb(0, 0, 0);"><span style="color: rgb(204, 51, 204);"><span style="font-style: italic;">iFunc model</span><span style="color: rgb(0, 0, 0);"><span style="font-style: italic;">);		</span></span></span></span></span><span style="font-style: italic;">% same as above</span><span style="color: rgb(51, 102, 255);"><span style="color: rgb(0, 0, 0);"><span style="color: rgb(204, 51, 204);"><span style="color: rgb(0, 0, 0);"><span style="font-style: italic;"></span><br></span></span></span></span>&gt;&gt; <span style="color: rgb(255, 0, 0);">h</span>=<span style="color: rgb(51, 102, 255);">ifitmakefunc</span><span style="color: rgb(51, 102, 255);"><span style="color: rgb(0, 0, 0);">('function_name', 'description', 'Parameter1 Parameter2 ...', ...<br>	<span style="color: rgb(204, 51, 204);">'expression'<span style="color: rgb(0, 0, 0);">, </span></span>[default parameter values], <span style="color: rgb(204, 51, 204);">'constraint'</span>);<br></span></span><span style="color: rgb(51, 102, 255);"><span style="color: rgb(0, 0, 0);"></span></span></pre>
    which is equivalent to:<br>
    <pre style="margin-left: 40px;">&gt;&gt; fun.Name=<span style="color: rgb(204, 51, 204);">'function short name'</span>;<br>&gt;&gt; fun.Description=<span style="color: rgb(204, 51, 204);">'function description'</span>;		<span style="font-style: italic;">% function long description</span><br style="font-style: italic;">&gt;&gt; fun.Parameters=<span style="color: rgb(204, 51, 204);">'Parameter1 Parameter2 ...'</span>;		<span style="font-style: italic;">% parameter names</span>. When empty, names are given according to the Expression analysis (when appropriate)<br>&gt;&gt; fun.Guess=[0 1 2 ...] or <span style="color: rgb(204, 51, 204);">'automatic'</span>;		<span style="font-style: italic;">% parameter default values (vector), or automatic mode</span><br>&gt;&gt; fun.Expression=<span style="color: rgb(204, 51, 204); font-style: italic;">'expression using p and x,y,z,t...'</span>;	<span style="font-style: italic;">% value of the model</span> (required). p is the vector that holds parameters. Axes are x,y,z,t,u,v,w.<br>&gt;&gt; fun.Constraint=<span style="color: rgb(204, 51, 204);">'evaluated before Expression'</span>;	<span style="font-style: italic;">% constraint evaluated </span>prior<span style="font-style: italic;"> to the model Expression</span><br>&gt;&gt; <span style="color: rgb(255, 0, 0);">h</span>=<span style="color: rgb(51, 102, 255);">iFunc</span><span style="color: rgb(51, 102, 255);"><span style="color: rgb(0, 0, 0);">(fun);<br>&gt;&gt; </span></span><span style="color: rgb(51, 102, 255);">fits</span>(a, <span style="color: rgb(255, 0, 0);">h</span><span style="color: rgb(204, 51, 204);"></span>);<span style="color: rgb(51, 102, 255);"><span style="color: rgb(0, 0, 0);"></span></span></pre>
    The generated code will basically be:<br>
    <pre style="margin-left: 40px;"><span style="color: rgb(51, 102, 255);">function</span> y=Name(p, axes, ...)<br><span style="font-style: italic;">% Description</span><br style="font-style: italic;"><span style="font-style: italic;">% Parameters: [fun.Parameters]</span><br>Constraint;<br>y=Expression;<br></pre>
    The resulting function has the ability to identify itself (<span
      style="color: rgb(51, 102, 255);">disp(model)</span> provides
    detailed informations), compute automatic starting parameters with
    e.g.<span style="color: rgb(51, 102, 255);"> feval(model, 'guess')</span>,
    display itself <span style="color: rgb(51, 102, 255);">plot(model)</span>,
    and evaluate its value of course <span style="color: rgb(51, 102,
      255);">feval(model, parameter_values, axes, ...)</span>. The
    resulting model is a <a href="iFunc.html">iFunc</a> object. Refer
    to that object description for more information.<br>
    <br>
    A large set of 1D (vector) and 2D (surface) models can be obtained
    from <a href="http://zunzun.com">ZunZun.com</a>.<br>
    <h4><a class="mozTocH4" name="mozTocId775891"></a>Creating complex
      functions from simple functions</h4>
    To <span style="font-weight: bold;">assemble existing functions</span>
    into new ones, you may use the iFunc operators <span
      style="font-style: italic;">e.g.</span>:&nbsp; <br>
    <pre style="margin-left: 40px;">&gt;&gt; <span style="color: rgb(255, 0, 0);">h</span>=<span style="color: rgb(51, 102, 255);"></span><span style="color: rgb(51, 102, 255);"><span style="color: rgb(0, 0, 0);"></span></span><span style="color: rgb(204, 51, 204);"><span style="color: rgb(51, 102, 255);">gauss</span>+<span style="color: rgb(51, 102, 255);">lorz</span><span style="color: rgb(0, 0, 0);">; h.Constraint = </span></span><span style="color: rgb(204, 51, 204);">'p(8)=0'</span>;<br></pre>
    which creates a new function which is the <span style="font-weight:
      bold; font-style: italic;">sum</span> of a Gaussian and a
    Lorentzian.&nbsp; Unspecified arguments are guessed/automatically
    set. The second redundant Lorentzian Background <span
      style="font-style: italic;">p(8)</span> parameter is forced to 0
    so that it does not correlate with the Gaussian Background <span
      style="font-style: italic;">p(4)</span>.
    <h4><a class="mozTocH4" name="mozTocId937554"></a>Using signal
      convolution/correlation in new functions</h4>
    It is possible to include a convolution (FFT based,
    multidimensional) in the core of the new function. The two function
    <span style="font-weight: bold; font-style: italic;">fconv</span>
    and <span style="font-weight: bold; font-style: italic;">fconvn</span>
    should then be used with the following syntax, where <span
      style="font-style: italic;">a</span> and <span style="font-style:
      italic;">b</span> are vectors/matrices:<br>
    <pre style="margin-left: 40px;">&gt;&gt; c = <span style="color: rgb(51, 102, 255);">fconv</span>(a,b);	<span style="font-style: italic;">	% returned convoluted object with size which is size(a)+size(b)+1</span><br>&gt;&gt; c = <span style="color: rgb(51, 102, 255);">fconv</span>(a,b, <span style="color: rgb(204, 51, 204);">'same'</span>);<span style="font-style: italic;">	% returned convoluted object </span><span style="font-style: italic;">with</span><span style="font-style: italic;"> size which is size(a)<br></span>&gt;&gt; c = <span style="color: rgb(51, 102, 255);">fconv</span>(a,b, <span style="color: rgb(204, 51, 204);">'valid'</span>);<span style="font-style: italic;">	% returned convoluted object </span><span style="font-style: italic;">with</span><span style="font-style: italic;"> size which is size(a)</span>-size(b)+1<br>&gt;&gt; c = <span style="color: rgb(51, 102, 255);">fconv</span>(a,b, <span style="color: rgb(204, 51, 204);">'pad'</span>);<span style="font-style: italic;">	% pads 'a' with starting/ending values to minimize border effects<br></span>&gt;&gt; c = <span style="color: rgb(51, 102, 255);">fconv</span>(a,b, <span style="color: rgb(204, 51, 204);">'center'</span>);<span style="font-style: italic;">	% centers 'b' so that convolution does not shift 'a'<br></span>&gt;&gt; c = <span style="color: rgb(51, 102, 255);">fconv</span>(a,b, <span style="color: rgb(204, 51, 204);">'norm'</span>);<span style="font-style: italic;">	% normalizes</span><span style="font-style: italic;"> 'b' so that convolution does not change 'a' integral<br></span>&gt;&gt; c = <span style="color: rgb(51, 102, 255);">fconv</span>(a,b, <span style="color: rgb(204, 51, 204);">'background'</span>);<span style="font-style: italic;">% subtracts</span><span style="font-style: italic;"> minimal value in 'b' so that convolution does not change 'a' integra</span>l<br>&gt;&gt; c = <span style="color: rgb(51, 102, 255);">fconv</span>(a,b, <span style="color: rgb(204, 51, 204);">'deconv'</span>);	<span style="font-style: italic;">% deconvolution, but very sensitive to noise (use with caution)</span><br></pre>
    When some data has to be convoluted with a response function (<span
      style="font-style: italic;">e.g.</span> instrument resolution
    function), the usual options to use should be:<br>
    <pre style="margin-left: 40px;">&gt;&gt; c = <span style="color: rgb(51, 102, 255);">fconv</span>(a,b, <span style="color: rgb(204, 51, 204);">'same pad background center norm'</span>);<br>&gt;&gt; c = <span style="color: rgb(51, 102, 255);">fconvn</span>(a,b);	<span style="font-style: italic;">% same as above</span> in a shorter call</pre>
    These convolution methods have been ported to <a href="iFunc.html">iFunc</a>
    models as<br>
    <ul>
      <li><span style="font-weight: bold;">conv: </span>convolution
        (calls fconv)<br>
      </li>
      <li><span style="font-weight: bold;">convn: </span>normalized
        convolution (calls fconvn)<br>
      </li>
      <li><span style="font-weight: bold;">xcorr: </span>cross-correlation






















        (calls fconv in correlation mode)<br>
      </li>
    </ul>
    If you wish to convolute two models, use<br>
    <pre style="margin-left: 40px;">&gt;&gt; a = <span style="color: rgb(51, 102, 255);">convn</span>(lorz, 3)		<span style="font-style: italic;">% convolution of a Lorentzian with a Gaussian of width 3<br></span>&gt;&gt; a = <span style="color: rgb(51, 102, 255);">convn</span>(lorz, gauss)	<span style="font-style: italic;">% a Voigt function...<br></span>&gt;&gt; a = <span style="color: rgb(51, 102, 255);">convn</span>(lorz, <span style="color: rgb(204, 51, 204);">'double(b)'</span>)<span style="font-style: italic;">; </span>a.Constraint = <span style="color: rgb(204, 51, 204);">'global b'</span>;	% convolute with a global variable 'b'<span style="font-style: italic;"></span></pre>
    where the vector/matrix<span style="font-style: italic;"> 'b'</span>
    holds the response function (filter) <span style="font-style:
      italic;">with the same axis binning</span> as the object <span
      style="font-style: italic;">'a'</span>.<br>
    <br>
    <span style="color: rgb(255, 0, 0);">Warning: </span>The <span
      style="font-style: italic;">fconv</span> and <span
      style="font-style: italic;">fxcorr</span> functions require the <span
      style="font-style: italic;">x</span> axis not to be coarsely
    sampled. In case the models/data contain narrow peaks (described
    with few points underneath e.g. less than 5), the fit model above
    will fail convolving. One solution is to artificially create a finer
    sampled axis, evaluate the function, and reduce back to the initial
    number of points. The constraints are used to define the new finer
    axis <span style="font-style: italic;">xx</span>, and the final
    result is re-sampled with 1 point out of 5 :<br>
    <pre style="margin-left: 40px;">&gt;&gt; h = <span style="color: rgb(51, 102, 255);">convn</span>(dho, gauss); <br>&gt;&gt; h.Constraint=<span style="color: rgb(204, 51, 204);">'x=linspace(min(x),max(x), 5*length(x))';</span><span style="color: rgb(51, 102, 255);"></span><span style="color: rgb(204, 51, 204);">	<span style="color: rgb(0, 0, 0); font-style: italic;">% artificially extend the 'x' axis</span><br><span style="color: rgb(0, 0, 0);">&gt;&gt; h = h + </span>'signal=signal(1:5:end);'<span style="color: rgb(0, 0, 0);">;</span></span>				<span style="font-style: italic;">% shrink 'signal' back to initial size</span><br></pre>
    <pre style="margin-left: 40px;"><span style="color: rgb(51, 102, 255);"><span style="color: rgb(0, 0, 0);"></span></span></pre>
    <h3><a class="mozTocH3" name="mozTocId854762"></a><span
        style="font-weight: bold;">How to write manually a model
        function</span></h3>
    We suggest that you start from the<span style="color: rgb(51, 102,
      255);"> 'gauss' </span>function in <span style="font-style:
      italic;">iFit/Scripts/Models, </span>and customize at will.
    Please retain the function core structure to ensure proper
    execution. More complex models can be derived from e.g. the <span
      style="color: rgb(51, 102, 255);">voigt</span> function.<br>
    <pre style="margin-left: 40px;">&gt;&gt; edit gauss<br>&gt;&gt; edit voigt<br>&gt;&gt; <span style="color: rgb(51, 102, 255);">ifitmakefunc</span>(voigt)	<span style="font-style: italic;">% pop-up a dialogue</span><br>&gt;&gt; <span style="color: rgb(51, 102, 255);">edit</span>(voigt)		<span style="font-style: italic;">% same as ifitmakefunc for iFunc objects</span><br></pre>
    <br>
    <hr style="width: 100%; height: 2px;">
    <div style="text-align: center;">
      <div style="text-align: center;"><span style="font-style: italic;">E.
Farhi






















          - iFit/fit models - </span><span style="font-style: italic;">
          $Date$ $Revision$ </span><span
          style="font-style: italic;"> </span>- back to <a
          href="index.html">Main iFit Page </a><a
          href="http://www.ill.eu/"><img title="ILL, Grenoble, France
            &lt;www.ill.eu&gt;" src="images/ILL-web-jpeg.jpg" alt="ILL,
            Grenoble, France &lt;www.ill.eu&gt;" style="border: 0px
            solid ; width: 53px; height: 50px;" align="right"></a> </div>
    </div>
  </body>
</html>
