<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <meta http-equiv="content-type" content="text/html;
      charset=windows-1252">
    <title>iFit: Changes and bugs</title>
  </head>
  <body>
    <ifit: changes="" title=""></ifit:>
    <h1 style="text-align: center;"><a class="mozTocH1"
        name="mozTocId294096"></a>iFit: Changes and Bugs<br>
    </h1>
    <br>
    <ol id="mozToc">
      <!--mozToc h3 1 h4 2 h3 3 h4 4 h5 5 h6 6-->
      <li><a href="#mozTocId919749">Releases and Changes </a></li>
      <li><a href="#mozTocId855650">Bugs list:</a>
        <ol>
          <li><a href="#mozTocId434193">File path names do not support
              spaces</a></li>
          <li><a href="#mozTocId482415">Data set maximum size</a></li>
          <li><a href="#mozTocId786389">CDF files written by Matlab can
              not be read by other software (hdfview, ncBrowse)</a></li>
          <li><a href="#mozTocId332568">Convolution brings strange
              results (Models/fconv) </a></li>
          <li><a href="#mozTocId473369">Too many warnings displayed</a></li>
          <li><a href="#mozTocId556618">Execution/compilation issue with
              text files importer (iLoad/iData/load, looktxt,
              CrysFML/cif2hkl)</a></li>
          <li><a href="#mozTocId63182">Limitations in the standalone
              (binary) package</a></li>
          <li><a href="#mozTocId853369">McStas and external programs can
              not be found from Matlab/iFit</a></li>
          <li><a href="#mozTocId309480">iFit standalone can not be
              launched (libmwmclmcrrt.so) </a></li>
          <li><a href="#mozTocId829705">iFit crashes when typing special
              characters (accents, ...)</a></li>
          <li><a href="#mozTocId267093">iFit fails with a message such
              as 'version `GFORTRAN_1.4' not found' or 'version
              `GCC_4.3.0' not found' </a></li>
          <li><a href="#mozTocId383867">Import of a text file fails</a></li>
          <li><a href="#mozTocId888843">Model sqw_phonon fails with
              Dacapo/Jacapo and MPI</a></li>
          <li><a href="#mozTocId62902">Matlab crashes when displaying 3D
              plots</a></li>
          <li><a href="#mozTocId879739">Matlab rendering is poor</a></li>
          <li><a href="#mozTocId16941">miFit/matlab crashes when
              starting/loading/saving</a></li>
        </ol>
      </li>
    </ol>
    <hr style="width: 100%; height: 2px;">
    <h3><a class="mozTocH3" name="mozTocId919749"></a>Releases and
      Changes<br>
    </h3>
    <span style="font-weight: bold;"></span>
    <ul>
      <li><b>2.0</b>: new iData and iFunc storage classes. The object
        usage is not modified, but sub-classes are now possible,
        allowing more specialized methods for specific use. See <a
          href="#mozTocId16941">here</a> if you experience load/save
        crashes. New <a href="Plot.html#mozTocId313946">iData/imroi</a>
        interactive region-of-interest and mask selection. New <a
          href="Plot.html#mozTocId633428">iData.slice</a> for 2D objects
        (only worked so far for 3D).<br>
      </li>
      <li><b>1.10</b>: new <a href="McStas.html">mccode</a> model
        maker, replacing the 'mcstas' function. New mccode_mcdisplay
        function which does not require external libraries. New <a
          href="iFunc.html#mozTocId604963">fmin/fmax</a> for iFunc.
        Added TextEdit as editor for <a href="iFit.html">iFit
          standalone</a>. Build <a href="iFunc.html">iFunc</a> from
        input Table data file. Save <a href="Save.html">iData</a> as
        AVI movie/PPTX/XLS/KML. <a href="Models_Phonons.html">Phonons</a>:
        added thermochemistry and <a href="Models_Phonons.html">Tutorial</a>
        ; PhonoPy support. Fix <a href="Python.html">Python/iFit</a>. <a
          href="../Applications/ResLibCal/doc/ResLibCal.html">ResLibCal</a>:
        allow export as HTML report and more coordinate frame choices,
        added FLEXX config. <a
href="https://github.com/McStasMcXtrace/iFit/issues?q=is%3Aissue+is%3Aclosed+label%3A%22release+1.10%22">List




          of tickets</a> for this release. (Aug 22nd 2017)<br>
      </li>
      <li><small><b>1.9</b>: added structure optimisation step before
          the phonon calculation in <a
            href="Models.html#mozTocId990577"><i>ab-initio</i> DFT
            phonon dispersion</a> Model. Added <a
            href="https://jochym.github.io/qe-doc/">QE/ASE</a> interface
          to Model Sqw. Faster phonon calculation using crystal
          symmetries. Improvements in <a href="Neutron_Scattering.html">S(q,w)


            treatment</a> scripts. <a href="Loaders.html">Data loaders</a>
          for Mass Spectroscopy formats, <a
            href="https://www.oecd-nea.org/dbdata/data/manual-endf/endf102.pdf">ENDF</a>
          and <a href="https://mcnp.lanl.gov/">ACE</a> nuclear data.
          Export iData/iFunc to <a href="Save.html#mozTocId593918">HTML</a>.
          Can now use <a href="Models.html#mozTocId908192">SpinW</a>
          objects as iFunc/Model. iData/iLoad can now import <a
            href="http://horace.isis.rl.ac.uk/Main_Page">Horace</a> Sqw
          files. New <a href="miFit.html"><b>miFit</b></a> user
          interface for data analysis [Load/Plot/Fit/Export], which
          allows 4D convolution/fit. <a
            href="../Applications/ResLibCal/doc/ResLibCal.html">ResLibCal</a>
          has now a full Monte-Carlo resolution calculation using <a
            href="McStas.html">McStas</a> templateTAS. (March 21st
          2017). <a
href="https://github.com/McStasMcXtrace/iFit/issues?q=is%3Aissue+is%3Aclosed+label%3A%22release+1.9%22">List








            of Tickets</a> for this release.</small><br>
      </li>
      <li><small><b>1.8</b>: read <a
href="https://www.ill.eu/instruments-support/instruments-groups/instruments/cyclops/description/instrument-layout/">ILL


































            Cyclops</a> HBIN and <a
            href="https://en.wikipedia.org/wiki/IDL_%28programming_language%29">IDL</a>
          SAV files. Iterative deconvolution as <i>deconv</i> method.
          Major upgrade of <a href="Models.html#mozTocId990577"><i>ab-initio</i>
            DFT phonon dispersion</a> Model, which now supports EMT,
          GPAW, ABINIT, Elk, Dacapo, NWChem, QuantumEspresso and VASP
          when installed. <a href="Neutron_Scattering.html">S(q,w)
            treatment</a> scripts to compare MD and measured dynamic
          structure factor, compute dynamic range, generalized density
          of states, total scattering cross sections, characteristic
          frequencies, powder average from 4D S(hkl,w). Full
          compatibility with Matlab releases &gt;= R2014b<i> (April 7th
            2016)</i>. <b>Upgrade 1.8-3</b>: Fix <i>read_anytext</i>
          to only use external 'looktxt': no more MeX <i>(April 19th
            2016).</i></small><br>
      </li>
      <li><small><b>1.7</b>: <a
href="http://www.bruker.com/fr/products/infrared-near-infrared-and-raman-spectroscopy/opus-software/overview.html">OPUS</a>
          FT-IR, LLB TAS, LabView <a
            href="http://www.ni.com/white-paper/4139/en/">LVM</a> and <a
            href="http://www.ni.com/white-paper/3727/en/">TDMS</a> file
          format import. Fixed curvature in <a
            href="../Applications/ResLibCal/doc/ResLibCal.html">ResLibCal</a>/Rescal5/Popovici













































          method. Added predefined TAS configurations in <a
            href="../Applications/ResLibCal/doc/ResLibCal.html">ResLibCal</a>
          and cross-checked computation methods. Fix TAS angles in 3D
          view. Initial support for nD Gaussians and 4D TAS convolution.
          Added Gaussian <a href="Math.html#mozTocId539072">smoothing</a>.
          Compatibility with Matlab new graphic objects (R2014b). Better
          handling of arguments to standalone <a href="iFit.html">iFit</a>.
          Added <a href="Math.html">fill</a> method to remove NaN's in
          iData objects. iFunc <a href="Models.html#mozTocId990577">4D
            S(q,w) models</a> from either analytical or ab-initio
          methods (Oct 14th 2015).</small><br>
      </li>
      <li><small><b>1.6</b>: Fix to text loader (looktxt). Sanitized HDF
          and NetCDF, McStas <a href="Loaders.html">import</a>.
          Cross-checked and validated <a
            href="../Applications/ResLibCal/doc/ResLibCal.html">ResLibCal</a>.
          iFunc models can now be used as objective function in <a
            href="Optimizers.html">optimization</a>. Fixed <a
            href="Math.html">iData/trapz</a> style operators. fix <a
            href="Fit.html">R-factor estimate</a>. (April 24 2014)</small><br>
      </li>
      <li><small><b>1.5.1</b>: fix for the importation of <a
            href="http://www.mccode.org">McStas/McXtrace</a> files.
          Added <a href="http://ifit.mccode.org/techdoc/">technical</a>
          documentation. Fix in binary iFunc operators (Guess). Fix for
          the R-factor determination. Fix in text importer (looktxt).<br>
        </small></li>
      <small> </small>
      <li><small><b>1.5</b>: Improved <a href="Loaders.html">file
            importation</a> system, <a
            href="http://en.wikipedia.org/wiki/JSON">JSON</a>, and
          NetCDF/CDF/NeXus/HDF support, import/export of <a
            href="http://www.mantidproject.org">Mantid</a> workspaces
          (HDF/NeXus), import of <a href="http://www.wavemetrics.com/">Igor














































            pro</a> wave files and Wavefront <a
            href="http://en.wikipedia.org/wiki/Wavefront_.obj_file">Obj</a>
          3D. <a href="Install.html">Installation</a> through Debian
          repository. Much faster save to MAT files. New <a
            href="Math.html#mozTocId539072">smooth, </a><a
            href="Math.html#mozTocId663052">continuous wavelet transform</a>,
          <a href="Math.html#mozTocId77311">k-means</a>, reshape and <a
            href="Math.html#mozTocId628538">resize</a> iData methods.
          Improvements in the iData processing speed and memory
          management. <i>(Sept 29th 2013)</i></small><br>
      </li>
      <li><small><b>1.4</b>: <a href="Python.html">PyFit</a> Python
          interface. Fix in <a href="Math.html">iData integration</a>
          routines error bar propagation (trapz, sum, ...). Fix in
          iData/combine when monitors are default (1). Better detection
          of duplicated data sets from recursive <a href="Load.html">iData/load</a>.
          Fix in <a href="Loaders.html">text import</a> (supports
          NaN,Inf, faster by 15%). Fixed auto guess in gauss,lorz,... <a
            href="Models.html">Models</a>. Added proper Unit/integration
          test infrastructure. Fixed some methods for <a
            href="iFunc.html"> iFunc</a> objects with parameter names
          followed with comments. Support for McStas/mcdisplay as an
          Application. </small><small><i> (June 28th 2013)</i></small><br>
        <span style="font-weight: bold;"></span></li>
      <li><small><span style="font-weight: bold;">1.3.1</span>: Support
          for loading CIF/CFL/ShelX structure, <a
href="http://www.msg.ucsf.edu/local/programs/ono/manuals/ofaq/Q.803.html">EZD</a>/<a
            href="http://en.wikipedia.org/wiki/MRC_%28file_format%29">MRC</a>/<a
            href="http://en.wikipedia.org/wiki/CCP4_%28file_format%29">CCP4</a>
          electron density <a href="Loaders.html">formats</a>.
          Load/save of <a href="http://en.wikipedia.org/wiki/YAML">YAML</a>/<a
            href="http://en.wikipedia.org/wiki/JSON">JSON</a>/<a
            href="http://en.wikipedia.org/wiki/XML">XML</a> files. New <a
            href="Models.html#mozTocId344379">Rietveld</a> model that
          uses a McStas neutron diffractometer model to convolve the
          structure factors and fit with diffractometer data. Added TAS
          neutron spectrometer resolution computation <a
            href="../Applications/ResLibCal/doc/ResLibCal.html">ResLibCal</a>
          as an Application. <a href="iData.html">iData</a> <span
            style="font-style: italic;">commandhistory</span> can be <a
            href="Save.html">saved</a> as a Matlab script. Added <span
            style="font-style: italic;">nlorz</span> and <span
            style="font-style: italic;">ngauss</span> <a
            href="Models.html">Models</a>. Fix of iData/<span
            style="font-style: italic;">combine</span> with scalar
          Monitor values. Better memory handling in <a href="Load.html">iData/load</a>.
          <a href="iFunc.html">iFunc</a> support parameter constraints
          fix/min/max/assign as <span style="font-style: italic;">object.&lt;par&gt;=&lt;value&gt;</span>.
          Fix in reading text files with changing columns number.
          Execution speed improvement in all object operators. Allow <a
            href="Fit.html">fitting</a> of event data sets.<br>
          <span style="font-weight: bold;"></span></small></li>
      <li><small><span style="font-weight: bold;">1.3</span>: Support
          for <a href="Loaders.html#mozTocId361032">SIF, MarCCD, Roper
            SPE</a> <a href="http://www.adsc-xray.com/products.html">ADSC</a>
          X-ray CCD. Export to <a
            href="http://www.web3d.org/x3d/specifications/x3d_specification.html">X3D</a>,
          fix for some text file import, support for the <a
            href="http://www.mathworks.com/products/parallel-computing/">Parallel














































            Computing Toolbox</a> (when available), improved
          interpolation, added <span style="font-style: italic;">meshgrid</span>,
          <span style="font-style: italic;">rotate, </span>radial
          integration (<a href="Math.html#mozTocId439767"><span
              style="font-style: italic;">cart2sph</span></a>), better
          support for event files, save of iFunc models to m-files.
          Added simple models for <a href="Models.html#mozTocId285330">small














































            angle scattering</a> form factors and structure factors.
          Improved <a href="McStas.html">McStas</a>/McXtrace support.
          Embedded help system, array and graphics editor in <a
            href="iFit.html">standalone</a> version. Save object history
          to script file <span style="font-style: italic;">(Nov. 29th
            2012)</span>.</small><br>
        <span style="font-weight: bold;"></span></li>
      <li><small><span style="font-weight: bold;">1.2</span>: Support
          for reading PLY, STL, OFF geometry files (vertices/faces).
          Improved import of text/ascii files containing numerics.
          Standalone <a href="iFit.html">iFit</a> distributable
          software. Speed-up by a factor x2.5. New <a href="iFunc.html">iFunc</a>
          model objects. Improved Optimizers and fitting. Reading of
          Chalk River <a
            href="http://www.nrc-cnrc.gc.ca/eng/ibp/cnbc.html">CNBC</a>
          data files, improved recursive reading of sub-directories and
          handling of iData arrays. New <a
            href="Plot.html#mozTocId406394">colormap</a> plotting
          method. Improvements in the Optimizers/McStas plotting. Speed
          up by +12% (March 16th, 2012)<br>
          <span style="font-weight: bold;"></span></small></li>
      <small> </small>
      <li><small><span style="font-weight: bold;">1.1</span>: new
          methods (save, diff, <a href="Math.html">hyperbolic functions</a>),














































          fix of the <a href="Optimizers.html">Levenberg-Marquardt
            optimizer</a>, improved Error propagation for unary
          operators, support for <a href="Loaders.html">import</a> of
          Analyze MRI (hdr/img) and Crystallographic Binary File (cbf)
          format, import post-process for HDF RITA2@PSI files, direct
          drag-drop data files using the open{ext} functions with Matlab
          &gt;= 2010, added many <a href="Models.html">fit models</a>
          including 2D functions <span style="font-style: italic;">signal=f(x,y)</span>.
          Improved speed by e.g. +25% <span style="font-style: italic;">(Feb














































            14th 2012)</span>. significant performance improvements
          (speedup by factor 2-10).<span style="font-style: italic;">
            (Oct 24th 2011)</span>. new fit <a
            href="Fit.html#mozTocId778987">criteria</a> (others than
          least-square), <a href="iData.html#mozTocId124075">link</a>
          as external/distant resources, better INX <a href="Load.html">import</a>
          <a href="Load.html#mozTocId338301">anchor</a> in file names
          for selective import, plenty of new <a href="Models.html">fit
            functions</a>, a few bug fixes (e.g. McStas 2D labels). <span
            style="font-style: italic;">(Sept 22nd 2011)</span><span
            style="text-decoration: underline;">. </span><a
            href="McStas.html">McStas</a> data files with Parameter
          member. New <a href="Plot.html#mozTocId734523">waterfall</a>
          plot stype for 3D data sets (<span style="font-style: italic;">Sept














































            6th, 2011</span>). Added correlation function method, plus a
          number of minor improvements (esp. in plot contextual menus),
          and bug fix for McStas 1D data set import <span
            style="font-style: italic;">(August 26th 2011</span>)</small><br>
        <span style="font-weight: bold;"></span></li>
      <li><small><span style="font-weight: bold;">1.0</span>: First
          official iFit release <span style="font-style: italic;">(August














































            16th 2011</span>)</small><br>
      </li>
    </ul>
    <h3><a class="mozTocH3" name="mozTocId855650"></a>Bugs list:</h3>
    <div style="margin-left: 40px;">You may test the package integrity
      by issuing the command:<br>
    </div>
    <pre style="margin-left: 80px;">&gt;&gt; <span style="color: rgb(51, 102, 255);">ifittest</span></pre>
    <div style="margin-left: 40px;"> which will test, in a few minutes,
      all the examples given in this documentation and report failures.
      The test may be aborted by closing the progress bar window.<br>
      <br>
      Please report bugs to <a href="mailto:ifit-users@mccode.org">ifit-users@mccode.org</a>
      or to me <span style="font-weight: bold;">[farhi (at) ill.fr]</span>.
      You are encouraged to register to the <a
        href="http://mail.mccode.org/cgi-bin/mailman/listinfo/ifit-users">ifit-users</a>
      list.<br>
    </div>
    <h4><a class="mozTocH4" name="mozTocId434193"></a>File path names do
      not support spaces</h4>
    <p>Under Windows systems, file names including spaces, such as in '<span
        style="font-style: italic;">My Documents</span>' may not be
      supported properly. In this case, move your files and directories
      to another location which does not contain spaces.<br>
    </p>
    <h4><a class="mozTocH4" name="mozTocId482415"></a>Data set maximum
      size</h4>
    The iFit package may currently handle routinely data sets up to few
    Gb. Larger data sets can still be loaded, but are restricted by the
    disk access and the available memory. Some file formats are limited
    to 2 Gb size. We recommend to use SSD to load files with increased
    efficiency.<br>
    <h4><a class="mozTocH4" name="mozTocId786389"></a>CDF files written
      by Matlab can not be read by other software (hdfview, ncBrowse)</h4>
    The <a href="http://en.wikipedia.org/wiki/Common_Data_Format">CDF</a>
    format (which you can view with <a
      href="http://www.opendx.org/about.html">OpenDX</a> and <a
      href="http://autoplot.org/">Autoplot</a>) is incompatible with the
    <a href="http://www.unidata.ucar.edu/software/netcdf/">NetCDF</a>
    one (which you can e.g. view with <a
      href="http://meteora.ucsd.edu/%7Epierce/ncview_home_page.html">ncview</a>,
    <a href="http://www.hdfgroup.org/hdf-java-html/hdfview">hdfview</a>,
    <a href="http://www.epic.noaa.gov/java/ncBrowse/">ncBrowse</a>, <a
      href="http://www.giss.nasa.gov/tools/panoply/">Panoply</a>). In
    such cases, we recommend to rather export in HDF5 format with:<br>
    <pre style="margin-left: 40px;">&gt;&gt; <span style="color: rgb(51, 102, 255);">save</span>(object, <span style="color: rgb(204, 51, 204);">'file.hdf5'</span>)</pre>
    <h4><a class="mozTocH4" name="mozTocId332568"></a>Convolution brings
      strange results (Models/fconv)<br>
    </h4>
    The <span style="font-style: italic;">fconv</span> function (FFT <a
      href="Math.html">convolution</a>) provided in the <a
      href="Models.html">Models</a> sub-library requires the two signals
    sampling not to be too coarse. Axes values too sparse will lead to
    inaccurate results. One solution is to re-sample the signals with
    more points. For <a href="iData.html">iData</a> objects, this can
    be achieved with e.g. the <span style="font-style: italic;">interp(object,














































      3)</span> to triple the number of points along axes.<br>
    <h4><a class="mozTocH4" name="mozTocId473369"></a>Too many warnings
      displayed</h4>
    If the warnings being displayed produce too much output, you may
    reduce the level of verbosity with:<br>
    <pre style="margin-left: 80px;">&gt;&gt; <span style="color: rgb(51, 102, 255);">warning off backtrace	<span style="font-style: italic; color: rgb(0, 0, 0);">% reduce the warning message length</span><br><span style="color: rgb(0, 0, 0);">&gt;&gt; </span>warning off			<span style="color: rgb(0, 0, 0); font-style: italic;">% suppress all warnings (not recommended)</span><br></span></pre>
    <h4><a class="mozTocH4" name="mozTocId556618"></a>Execution/compilation

































      issue with text files importer (iLoad/iData/load, looktxt,
      CrysFML/cif2hkl)</h4>
    You should first try the automatic fix procedure:<br>
    <pre style="margin-left: 40px;">&gt;&gt; <span style="color: rgb(51, 102, 255);">iLoad</span>(<span style="color: rgb(204, 51, 204);">'force'<font color="#000000">)	% checks and possibly re-compiles text and CBF importers<br></font></span>&gt;&gt; <span style="color: rgb(51, 102, 255);">iLoad</span>(<span style="color: rgb(204, 51, 204);">'compile'<font color="#000000">)	% fully re-compiles text and CBF importers</font></span><br></pre>
    The recompilation tries to:<br>
    <ol>
      <li>use the matlab <i>mex</i> command (requires a valid C
        compiler supported by Matlab) ;<br>
      </li>
      <li>use of any other C compiler such as <a href="https://gcc.gnu.org/">gcc</a>, <a href="https://software.intel.com/en-us/intel-compilers">ifc</a>,
        <a href="http://www.pgroup.com/">pgcc</a>, <a href="http://clang.llvm.org/">clang/llvm</a>, <a href="http://bellard.org/tcc/">tcc</a>;</li>
      <li>use any Fortran compiler such as <a href="https://gcc.gnu.org/fortran/">gfortran</a>, <a href="http://www.g95.org/">g95</a>, <a href="http://www.pgroup.com/">pgfc</a>, <a href="https://software.intel.com/en-us/fortran-compilers">ifort</a>.</li>
    </ol>
    Most systems provide a default C compiler. <br>
    <ul>
      <li>Linux systems usually ship with gcc.</li>
      <li>MacOSX systems require to install the Xcode development tools,
        or the HPC GCC suite. </li>
      <li>Windows 32 systems may use the LCC compiler shipped with
        Matlab. </li>
      <li>Windows 64 systems must have Microsoft Visual C++ installed
        (refer to the <a href="Install.html#mozTocId359173">Install</a>
        page for the procedure).</li>
    </ul>
    You may need to select the compiler with the <i>mex -setup</i>
    command from Matlab, but as said above, any other compiler can be
    used.<br>
    <br>
    In some cases, the provided iFit/Loaders/private/looktxt commands
    may fail to execute (wrong architecture, missing library). <br>
    Under Windows 64bit systems, you may need the Visual C++ runtime
    libraries e.g. <i>msvc[mpr]90.dll</i> which are provided with the
    Visual C++ installation (see below), to put in the Windows system
    directory.<br>
    <div style="margin-left: 40px;"> <br>
    </div>
    It has been reported that MeX compilation may fail when spaces are
    part of the path name to the iFit location (esp. under Windows
    systems). Move <span style="font-style: italic;">iFit</span> to an
    other location which does not include spaces in its name (e.g. avoid
    <span style="font-style: italic;">My Documents</span>) for
    compilation.<br>
    <br>
    <i><b>Manual compilation</b></i><br>
    <br>
    If all this fails, you can try a manual compilation as follows.<br>
    <br>
    A C compiler is required to make use of the generic text importer <i>looktxt</i>.
    Navigate to the <span style="font-style: italic;">iFit/Libraries/Loaders/private













    </span>directory, and issue:<br>
    <blockquote>
      <pre># gcc -O2 -o looktxt looktxt.c -lm</pre>
    </blockquote>
    A Fortran compiler is required when using <span style="font-style:
      italic;">cif2hkl</span> (CIF,CFL,PCR,ShelX files), especially for
    the Rietveld model function. Navigate to the <span style="font-style: italic;">iFit/Scripts/Models/scattering/powder_diffraction</span>
    directory and issue:<br>
    <pre style="margin-left: 40px;"># gfortran -O2 -o cif2hkl cif2hkl.F90 -lm<br></pre>
    which creates a <i>cif2hkl</i> executable file, used by iFit.
    Remove the collateral *.mod files.<br>
    <br>
    Once done, check from iFit:<br>
    <pre style="margin-left: 40px;">&gt;&gt; <span style="color: rgb(51, 102, 255);">iLoad</span>(<span style="color: rgb(204, 51, 204);">'force'<font color="#000000">)	% checks and possibly re-compiles text and CBF importers</font></span></pre>
    Refer to the related item in the <a href="Install.html#mozTocId359173">Install</a> page.<br>
    <h4><a class="mozTocH4" name="mozTocId63182"></a>Limitations in the
      standalone (binary) package</h4>
    When running the standalone version (binary), new Matlab functions
    can <span style="font-weight: bold; font-style: italic;">not</span>
    be defined, except anonymous functions (inline). You may use iFunc
    models as a substitute. Also, the <span style="font-style: italic;">doc,

































      web</span> and <span style="font-style: italic;">edit</span>
    commands are limited, and may not work properly, depending on the
    system.<br>
    <h4><a class="mozTocH4" name="mozTocId853369"></a>McStas and
      external programs can not be found from Matlab/iFit</h4>
    The location of executable programs available from the system are
    stored in the PATH environment variable. But on some systems (e.g.
    MacOSX), this variable is not fully initialised when used from
    Matlab/iFit.<br>
    <br>
    The following issue may show-up for any external program launched
    from Matlab/iFit, e.g. <a href="http://www.mcstas.org">McStas</a>,
    <a href="http://www.homepages.ucl.ac.uk/%7Eucfbdxa/phon/">PHON</a>,
    <a href="http://www.quantum-espresso.org/">Quantum Espress</a>, <a href="https://wiki.fysik.dtu.dk/ase/">ASE</a>. We detail the case
    of 'mcstas'.<br>
    <br>
    To diagnose this issue, open a Terminal, and test if e.g. 'mcstas'
    is properly installed (the example below if for MacOSX/Linux):<br>
    <blockquote>
      <pre><b>% mcstas -v</b><br>mcstas-2.3-rc2 version 2.3-rc2 (Nov. 16, 2015)<br>Copyright (C) DTU Physics and Risoe National Laboratory, 1997-2015<br>Additions (C) Institut Laue Langevin, 2003-2015<br>All rights reserved<br><b>% which</b><b> mcstas</b><br>/usr/bin/mcstas<br></pre>
    </blockquote>
    Then you need to add the path to 'mcstas' executables inside the
    PATH variable seen from Matlab. <br>
    Type, from Matlab/iFit prompt:<br>
    <blockquote>
      <pre>&gt;&gt; <font color="#3366ff">setenv</font>(<font color="#cc33cc">'PATH'</font>, [getenv('PATH') <font color="#cc33cc">':/usr/local/bin' ':/usr/bin' ':/usr/share/bin'</font> ]);	<i>% under MacOSX and Linux</i><br>&gt;&gt; <font color="#3366ff">setenv</font>(<font color="#cc33cc">'PATH'</font>, [getenv('PATH') <font color="#cc33cc">'C:\mcstas\bin'</font> ]);	<i>% under Windows</i><br></pre>
    </blockquote>
    Once done, e.g. <a href="http://www.mcstas.org">McStas</a> and
    other programs will be immediately reachable from Matlab/iFit. <br>
    This procedure may have to be repeated whenever Matlab/iFit is
    (re)started.<br>
    <br>
    <h4><a class="mozTocH4" name="mozTocId309480"></a>iFit standalone
      can not be launched (libmwmclmcrrt.so)<br>
    </h4>
    <p>When starting <a href="iFit.html">iFit</a> standalone, you get a
      message such as:<br>
    </p>
    <pre>./run_ifit: error while loading shared libraries: libmwmclmcrrt.so: cannot open shared object file: No such file or directory</pre>
    <p>This message indicates that the Matlab Runtime Library has not
      been found. Instal the MCR as indicated in the <a href="Install.html">Install</a> page. You may have to edit the
      'ifit' command and set the location of the MCR. Alternatively, you
      can set the MCRROOT environment variable to point to it, e.g.
      under <i>bash</i> (Linux/Mac OSX):<br>
    </p>
    <ul>
      <li>export MCRROOT="/opt/MATLAB/MATLAB_Compiler_Runtime/v713"</li>
    </ul>
    <h4><a name="mozTocId829705" class="mozTocH4"></a>iFit crashes when
      typing special characters (accents, ...)</h4>
    <p>The <a href="iFit.html">iFit</a> standalone (compiled version)
      can be used from the prompt/command line, within a terminal.
      However, the Matlab <i>readline</i> library can not handle
      properly localised characters (e.g. with accents, for specific
      languages) [<a href="http://www.mathworks.com/support/bugreports/624817">bug
        624817</a>]. <br>
    </p>
    <p>You thus have to be cautious when typing, to avoid e.g. à, ä, ø,
      ñ and so on, or an immediate crash will occur, without saving your
      work, and save your work regularly. US keyboard characters are all
      fully supported.<br>
    </p>
    <ul>
    </ul>
    <h4><a class="mozTocH4" name="mozTocId267093"></a>iFit fails with a
      message such as '<font color="#800000">version</font><font color="#800000"> `GFORTRAN_1.4' not found'<font color="#000000">
          or</font> 'version `GCC_4.3.0' not found'<br>
      </font></h4>
    Matlab comes with its own C and Fortran libraries (e.g. in
    MATLABROOT/<font color="#800000"><span style="color: rgb(0, 0, 0);">sys/os/&lt;arch&gt;/)</span><span style="color: rgb(51, 102, 255);"></span></font>. Some of these
    may not match those from the running system (seen on Linux systems).
    <br>
    <br>
    The following issue may show-up for any external program launched
    from Matlab/iFit, e.g. <a href="http://www.mcstas.org">McStas</a>,
    <a href="http://www.homepages.ucl.ac.uk/%7Eucfbdxa/phon/">PHON</a>,
    <a href="http://www.quantum-espresso.org/">Quantum Espress</a>, <a href="https://wiki.fysik.dtu.dk/ase/">ASE</a>, looktxt, cif2hkl.<br>
    In this case, as e.g. McStas runs from a Matlab environment that
    overloads libraries on top of the normal libraries from the system -
    used by external programs - you may get a message such as (here <span style="font-style: italic; color: rgb(51, 102, 255);">libgfortran.so</span>
    is faulty) :<br>
    <pre style="margin-left: 40px;"><font color="#800000">Can't load '/usr/local/lib/perl/5.12.4/auto/PGPLOT/PGPLOT.so' for module</font> <font color="#800000">PGPLOT: <br>/usr/local/MATLAB/R2012a/sys/os/glnxa64/<span style="color: rgb(51, 102, 255);">libgfortran.so.3</span>: version</font> <font color="#800000">`GFORTRAN_1.4' not found <br>(required by /usr/lib/libpgplot.so.5) at</font> <font color="#800000">/usr/lib/perl/5.12/DynaLoader.pm line 192.</font> <br><font color="#800000">at /usr/local/lib/mcstas/tools/perl/mcstas_config.perl line 123</font></pre>
    A similar message has also been reported for the <font color="#3366ff">libgcc_s.so</font> library with error e.g. '<font color="#cc0000">version&nbsp;`GCC_4.3.0'&nbsp;not&nbsp;found</font>'.<br>
    <br>
    On an Apple Mac OS X system, the faulty library is e.g.<br>
    <blockquote>/Applications/MATLAB_R2010a.app/sys/os/maci64/libgfortran.3.dylib<br>
    </blockquote>
    In order to solve this, you need to either remove or update the
    faulty Matlab libraries with the one from the system. The following
    procedure is valid for Linux systems (where it was identified),
    assuming Matlab has been installed in e.g. MATLABROOT =
    /usr/local/MATLAB/R2012a - but it may also be in e.g.
    /opt/MATLAB/R2012a.<br>
    <br>
    <b>The first attempt</b> is to simply rename the faulty library
    shipped with Matlab, e.g. (you may also remove it):<br>
    <pre style="margin-left: 40px;"><font color="#800000"># sudo mv /usr/local/MATLAB/R2012a/sys/os/glnxa64/<span style="color: rgb(51, 102, 255);">libgfortran.so.<font color="#800000">3</font></span></font> <font color="#800000">/usr/local/MATLAB/R2012a/sys/os/glnxa64/<span style="color: rgb(51, 102, 255);">libgfortran.so.<font color="#800000">3</font></span></font>.org</pre>
    or<br>
    <pre style="margin-left: 40px;"><font color="#800000"># sudo mv /usr/local/MATLAB/R2012a/sys/os/glnxa64/<span style="color: rgb(51, 102, 255);">l</span></font><font color="#3366ff">ibgcc_s.so.1 </font><font color="#800000">/usr/local/MATLAB/R2012a/sys/os/glnxa64/<span style="color: rgb(51, 102, 255);">l</span></font><font color="#3366ff">ibgcc_s.so.1</font>.org</pre>
    <pre style="margin-left: 40px;"><font color="#800000"><span style="color: rgb(51, 102, 255);"></span></font></pre>
    Then restart Matlab/iFit to check if the issue is solved.<br>
    <br>
    <b>If this is still not solved</b>, we then look for locations of
    the faulty library in the system (requires package <span style="font-style: italic;">locate</span> or <span style="font-style: italic;">mlocate</span> to be installed -
    alternatively you can use <span style="font-style: italic;">ldconfig

































      -v</span> and look where <span style="font-style: italic;">libgfortran</span>
    appears in the long list...)<br>
    <pre style="margin-left: 40px;"><span style="color: rgb(51, 102, 255);"># locate libgfortran.so</span>
/usr/lib/x86_64-linux-gnu/libgfortran.so.3 <span style="color: rgb(204, 51, 204); font-style: italic;">&lt;- this is the library from the system, to put in the Matlab location</span><br></pre>
    Then we first make a copy of the initial Matlab library to update<br>
    <pre style="margin-left: 40px;"><span style="color: rgb(51, 102, 255);"># sudo mv /usr/local/MATLAB/R2012a/sys/os/glnxa64/libgfortran.so.3 /usr/local/MATLAB/R2012a/sys/os/glnxa64/libgfortran.so.3.org</span><br></pre>
    Then we copy the library from the system into the Matlab location<br>
    <pre style="margin-left: 40px;"><span style="color: rgb(51, 102, 255);"></span><span style="color: rgb(51, 102, 255);"># sudo ln -s /usr/lib/x86_64-linux-gnu/libgfortran.so.3 /usr/local/MATLAB/R2012a/sys/os/glnxa64/</span></pre>
    Then, you need to restart Matlab/iFit to notice the issue has been
    fixed.<br>
    <h4><a class="mozTocH4" name="mozTocId383867"></a>Import of a text
      file fails</h4>
    You can try the automatic fix procedure:<br>
    <pre style="margin-left: 40px;">&gt;&gt; <span style="color: rgb(51, 102, 255);">iLoad</span>(<span style="color: rgb(204, 51, 204);">'force'<font color="#000000">)	% checks and possibly re-compiles text and CBF importers<br></font></span>&gt;&gt; <span style="color: rgb(51, 102, 255);">iLoad</span>(<span style="color: rgb(204, 51, 204);">'compile'<font color="#000000">)	% fully re-compiles text and CBF importers</font></span><br></pre>
    If this fails, then first check that the <i>looktxt</i> command is
    working (this will appear in the error message). If not, remove the
    invalid one (in iFit/Libraries/Loaders/private) and restart the
    importation. A new external command will be compiled from the source
    (requires a valid compiler, see <a href="#mozTocId556618">above</a>).<br>
    <br>
    If the executable <i>looktxt</i> is valid, but you can not import a
    reluctant <span style="font-weight: bold;">text</span> file, try
    the most tolerant text reader configurations:<br>
    <pre style="margin-left: 40px;">&gt;&gt; <span style="color: rgb(51, 102, 255);">iData</span>(<span style="color: rgb(204, 51, 204);">'filename','text format with fast import method'</span>)<br>&gt;&gt; <span style="color: rgb(51, 102, 255);">iData</span>(<span style="color: rgb(204, 51, 204);">'filename','Data (text format)'</span>)</pre>
    will import the raw content, without post formatting of the object
    in memory. You will probably need to assign manually some of the
    Signal and Axes (see <a href="iData.html">iData</a> object help).<br>
    <br>
    Text files containing <span style="font-weight: bold;">NaN's inside
      matrices</span> are not imported properly in iFit version &lt;=
    1.6 (NaN is read as a text inside a matrix, and thus breaks the
    matrix into bits). One way is to replace all NaN's by 0 values. This
    also stands for <b>Inf's</b> and other text embedded inside
    numerical blocks.<br>
    <h4><a class="mozTocH4" name="mozTocId888843"></a>Model sqw_phonon
      fails with Dacapo/Jacapo and MPI</h4>
    You should check the executable 'dacapo_mpi.run' from the command
    line. If an error message indicates missing libraries '<i>libmpi_f90.so.0</i>'
    and '<i>libmpi_f77.so.0</i>', then first check that <i>openmpi</i>
    is installed and identify the actual library with e.g.:<br>
    <blockquote>
      <pre>% locate libmpi_f77.so</pre>
      <pre>/usr/lib/libmpi_f90.so.1</pre>
    </blockquote>
    then create a soft link from the existing library to the missing
    one:<br>
    <blockquote>
      <pre>% sudo ln -s /usr/lib/libmpi_f90.so.1 /usr/lib/libmpi_f77.so.0</pre>
    </blockquote>
    <font color="#ff0000"> Warning: </font>We do not recommend using
    Dacapo/Jacapo, as this software is not maintained anymore.<br>
    <h4><a name="mozTocId62902" class="mozTocH3"></a>Matlab crashes when
      displaying 3D plots</h4>
    Since Matlab R2014b, the underlying infrastructure for display of
    plots has been fully revamped. As a consequence, displays are much
    nicer, but also much slower to render. Also, depending on the
    graphics card/driver installed on the computer, Matlab may crash
    with messages such as:<br>
    <blockquote>
      <pre>Nativewindow X11 IOError: Display 0x7f44e040e8b0 (:0.0): Bad address</pre>
      <pre>MATLAB: javainit.cpp:1411: void {anonymous}::mwJavaAbort(): Assertion `Fatal Java Exception.&nbsp; See Java Crash Report for details.' failed.</pre>
    </blockquote>
    A way to get things fixed is to switch to the software OpenGL
    rendering. Start Matlab and type immediately:<br>
    <ul>
      <li><font color="#3366ff">opengl</font> <font color="#cc33cc">save
          software</font></li>
    </ul>
    then exit Matlab and restart it.<br>
    <br>
    The immediate consequence is that all works (good), but also it gets
    even slower (!!!). Calculations are not affected.<br><h4><a class="mozTocH4" name="mozTocId879739"></a>Matlab rendering is poor</h4>If you get messages such as:<br><blockquote><b>Warning:</b> OpenGL appears to be installed incorrectly.<br></blockquote>or<br><blockquote><b>libGL error</b>: unable to load driver: radeonsi_dri.so<br></blockquote>and the rendering is not so nice (e.g. slow and no transparency), then you may overcome this issue by launching the <i>matlab</i> and <i>ifit</i> commands with e.g.:<br><blockquote>LD_PRELOAD='/usr/$LIB/libstdc++.so.6' ifit<br></blockquote>and<br><blockquote>LD_PRELOAD='/usr/$LIB/libstdc++.so.6' matlab<br></blockquote>This overrides the C library shipped with Matlab/iFit in order to use the system one (which e.g. works better with the installed graphics cards).<br>
    <h4><a name="mozTocId16941" class="mozTocH4"></a>miFit/matlab
      crashes when starting/loading/saving</h4>
    The storage class for iData and iFunc has changed. This makes old
    '.mat' files crash when imported. To solve this issue, you should
    start a previous version of iFit (e.g. 1.10) and export your objects
    into e.g. HDF5 files. Then, with the new iFit version, import back
    this files to recreate the same iData objects.<br>
    <br>
    With miFit, you may reset the application with:<br>
    <ul>
      <li><font color="#3366ff">mifit</font> <font color="#cc33cc">reset</font><br>
      </li>
    </ul>
    which fully resets its configuration and data to the factory
    settings. Your existing data stored in miFit will be lost.
    Alternatively, you may start an older iFit version (e.g. 1.10), and
    export the workspace items into e.g. HDF5. Then start the new miFit
    interface (from iFit 2.x), and load the HDF5 files in the workspace.<br>
    <br>
    <hr style="width: 100%; height: 2px;">
    <div style="text-align: center;">
      <div style="text-align: center;"><span style="font-style: italic;">E.
Farhi











          - iFit/Changes - </span><span style="font-style: italic;">
          $Date$ $Revision$ </span><span style="font-style: italic;"> </span>-
        back to <a href="index.html">Main iFit Page </a><a href="http://www.ill.eu/"><img title="ILL, Grenoble, France
            &lt;www.ill.eu&gt;" src="images/ILL-web-jpeg.jpg" alt="ILL,
            Grenoble, France &lt;www.ill.eu&gt;" style="border: 0px
            solid ; width: 53px; height: 50px;" align="right"></a> </div>
    </div>
  

</body></html>